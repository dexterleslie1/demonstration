## IoT概念

### 一句话概括 IoT

**IoT（物联网）就是让原本“沉默”的物体通过互联网“开口说话”，让它们能够被感知、被控制、甚至相互交流。**

---

### 核心思想：万物互联

传统的互联网主要是人与人的连接（比如你用电脑、手机上网与人交流）。而 **物联网的核心是“物与物”、“物与人”的连接**。

这里的“物”可以是任何东西：
*   **家用电器**：灯泡、空调、冰箱、扫地机器人
*   **日常物品**：手表、门锁、体重秤
*   **城市设施**：路灯、停车位、监控摄像头
*   **工业设备**：工厂的机器、农场的传感器、物流包裹

### IoT 是如何工作的？

一个典型的 IoT 系统通常包含四个关键部分，就像一个协同工作的团队：

1.  **感知层（感官）**：设备上的**传感器** 负责收集数据。比如，温度传感器感知室温，摄像头捕捉图像，GPS 模块定位位置。
2.  **网络层（神经）**：通过**网络**（如 Wi-Fi、蓝牙、5G、LoRa）将收集到的数据安全地传输到处理中心。
3.  **平台层（大脑）**：**云平台或服务器** 对海量数据进行分析、处理和管理。比如，判断室温是否过高，或者发现设备异常。
4.  **应用层（手脚）**：根据平台的指令，**执行器** 会采取行动，或者将信息呈现给用户。比如，远程关闭空调，或在你的手机App上发送警报。

**举个例子：智能农业**
*   **感知**：土壤里的湿度传感器检测到土地干旱了。
*   **传输**：传感器通过无线网络将这个“我渴了”的信号发送到云平台。
*   **处理**：云平台分析数据后，判断需要浇水。
*   **执行**：平台向灌溉系统的阀门发出指令，阀门自动打开进行浇水。同时，农场主的手机可能会收到一条通知：“农田A区已开始灌溉”。

### 生活中的 IoT 应用实例

IoT 已经深入我们生活的方方面面：

*   **智能家居**：用手机远程控制家里的灯光、空调；智能门铃有人按门铃时，你可以在手机上看到是谁；扫地机器人自动规划路线清扫。
*   **可穿戴设备**：智能手表/手环监测你的心率、步数和睡眠质量，并将数据同步到手机App上。
*   **智慧城市**：智能路灯根据人流量和天色自动调节亮度；智能停车系统引导你找到空车位。
*   **车联网**：汽车可以将实时路况数据上传到云端，帮助地图App规划更优路线，实现自动驾驶的雏形。
*   **工业物联网**：工厂里的机器可以预测自身何时需要维护，避免突然停机。

### 总结 IoT 的价值

IoT 的最终目的是**提升效率、节约资源、带来更智能、更便捷的体验**。它让物理世界和数字世界深度融合，为我们创造了巨大的可能性。

## 主流开源的MQTT代理

>提示：学习过程使用EMQX作为代理。

目前主流且活跃的开源 MQTT 代理（Broker）主要有以下几个，它们各有特点和适用场景，我来为你详细介绍一下。

### 主流开源 MQTT 代理一览

| 名称          | 开发语言 | 特点                                                         | 适用场景                                         |
| :------------ | :------- | :----------------------------------------------------------- | :----------------------------------------------- |
| **EMQX**      | Erlang   | **高性能、分布式、云原生**。单机支持百万级连接，集群稳定。功能极其丰富（规则引擎、数据桥接等）。 | 大规模物联网平台、车联网、关键业务系统。         |
| **Mosquitto** | C        | **轻量级、稳定、易于部署**。Eclipse 项目，是 MQTT 协议的标准参考实现。 | 初学者学习、小型项目、嵌入式系统、资源受限环境。 |
| **NanoMQ**    | C        | **边缘计算首选、超轻量级**。专为边缘侧设计，资源占用极低，支持多种总线协议。 | 物联网边缘计算、嵌入式 MQTT 网关。               |
| **HiveMQ**    | Java     | **企业级、高可靠、功能全面**。社区版功能强大，企业版提供高级支持和服务。 | 对稳定性和企业级支持有要求的大中型项目。         |
| **Vernemq**   | Erlang   | **高性能、可分布式集群**。专为高并发、低延迟场景优化，插件系统灵活。 | 需要高吞吐量和可靠性的实时消息系统。             |
| **Aedes**     | Node.js  | **轻量级、基于 Node.js**。方便与 Node.js 技术栈集成，适合快速原型开发。 | Node.js 全栈开发、快速原型验证、中小型应用。     |

---

### 详细介绍与选择建议

#### 1. EMQX
- **官网：** https://www.emqx.io/
- **简介：** 这是目前性能最强大、功能最全面的开源 MQTT 代理之一。使用 Erlang/OTP 平台开发，天生具备高并发和分布式能力。
- **核心优势：**
    - **极致性能：** 官方宣称单节点可支持 500 万 MQTT 连接。
    - **集群能力：** 集群功能成熟稳定，易于横向扩展。
    - **生态丰富：** 内置强大的**规则引擎**，可以轻松地将 MQTT 消息与数据库（如 MySQL, PostgreSQL, Redis, MongoDB）、消息队列（如 Kafka, RocketMQ）及云服务（如 AWS S3）进行集成。
    - **云原生友好：** 支持 Kubernetes 部署，有完整的 Operator 项目。
- **选择建议：** 如果你的项目面向海量设备连接、需要高可用集群、或者有复杂的数据集成需求（例如将设备数据存入数据库或转发到 Kafka），EMQX 是首选。

#### 2. Mosquitto
- **官网：** https://mosquitto.org/
- **简介：** 由 Eclipse 基金会维护，是最老牌、最经典的开源 MQTT 代理，可以说是 MQTT 协议的“官方参考实现”。
- **核心优势：**
    - **极其轻量：** 占用资源非常少，安装包只有几百 KB。
    - **极其稳定：** 经过长期、广泛的实践检验，非常稳定可靠。
    - **部署简单：** 配置简单，上手极快。
- **选择建议：** 这是**初学者入门 MQTT 的最佳选择**。也适用于设备数量不多（例如几千以下）的小型项目、测试环境、资源紧张的嵌入式设备（如树莓派）等。它是功能完整性的基准。

#### 3. NanoMQ
- **官网：** https://nanomq.io/
- **简介：** EMQ 公司推出的面向边缘计算的轻量级 MQTT 代理，是 EMQX 在边缘侧的完美补充。
- **核心优势：**
    - **超轻量：** 专为资源受限的边缘设备设计，资源占用极低。
    - **边缘特性：** 内置了消息持久化、数据缓存和断线重传等边缘场景必需的功能。
    - **多协议网关：** 除了 MQTT，还可以作为 **NanoSDK** 支持 DDS、ZMQ、Nanomsg/NNG 等协议的总线网关。
- **选择建议：** 如果你的应用场景是**物联网边缘网关**，需要在网关上进行消息汇聚、协议转换或边缘计算，NanoMQ 是不二之选。

#### 4. HiveMQ
- **官网：** https://www.hivemq.com/
- **简介：** 一个基于 Java 开发的企业级 MQTT 代理，社区版功能已经非常强大。
- **核心优势：**
    - **企业级支持：** 背后有商业公司提供专业的技术支持和企业版服务。
    - **高可靠性：** 在设计上非常注重企业级部署的稳定性和可靠性。
    - **扩展性强：** 提供了完善的 SDK 和插件系统，方便定制开发。
- **选择建议：** 适合对稳定性、售后服务和技术支持有较高要求的企业级用户，特别是那些计划从社区版平滑过渡到企业版的团队。

### 如何选择？

你可以根据以下流程来快速决策：

1.  **你是初学者或个人开发者，只是想学习和搭建简单的 demo？**
    *   **推荐：Mosquitto**。简单、稳定、够用。

2.  **你的项目是中小规模（连接数在几万以内），没有复杂的集成需求？**
    *   **推荐：Mosquitto 或 Aedes**。Mosquitto 更通用，Aedes 适合 Node.js 技术栈。

3.  **你的项目是大型物联网平台，需要支撑海量设备（数十万到百万级连接），并且需要高可用集群和数据集成？**
    *   **推荐：EMQX**。它的性能和功能是为这种场景量身定制的。

4.  **你的场景是边缘计算，需要在网关上运行一个轻量级的代理？**
    *   **推荐：NanoMQ**。它是专为边缘侧设计的。

5.  **你的项目是企业级应用，非常看重稳定性和官方商业支持？**
    *   **推荐：HiveMQ 或 EMQX 企业版**。可以优先试用它们的社区版，再根据需求考虑商业支持。

## Docker Compose运行EMQX

>详细用法请参考本站示例：https://gitee.com/dexterleslie/demonstration/tree/main/demo-iot/docker-compose.yaml

docker-compose.yaml：

```yaml
version: '3.8'

services:
  # EMQX单机版
  emqx:
    # 建议使用一个具体的稳定版本，而不是 latest
    image: emqx/emqx:5.6.1
    healthcheck:
      test: ["CMD", "/opt/emqx/bin/emqx", "ctl", "status"] # 健康检查
      interval: 5s
      timeout: 25s
      retries: 5
    # 添加以下 volumes 配置
    volumes:
      # 持久化 MQTT 消息、规则引擎数据等
      - volume-demo-emqx-data:/opt/emqx/data
      # 持久化日志，方便排查问题
      - volume-demo-emqx-log:/opt/emqx/log
    ports:
      # MQTT TCP 端口
      - "1883:1883"
      # MQTT TCP/WebSocket 端口
      - "8083:8083"
      # MQTT TCP/WebSocket SSL 端口
      - "8084:8084"
      # MQTT SSL 端口
      - "8883:8883"
      # EMQX 仪表板端口
      - "18083:18083"

volumes:
  volume-demo-emqx-data:
  volume-demo-emqx-log:
```

启动服务

```sh
docker compose up -d
```

访问控制台 http://localhost:18083，帐号：admin，密码：public。