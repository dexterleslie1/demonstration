- name: "销毁api服务"
  hosts: api
  tasks:
    - name: "使用Docker Compose down销毁api服务"
      shell: |
        set -e
        cd ~/deployer-flash-sale/service
        docker compose down -v

- name: "销毁crond服务"
  hosts: crond
  tasks:
    - name: "使用Docker Compose down销毁crond服务"
      shell: |
        set -e
        cd ~/deployer-flash-sale/crond
        docker compose down -v
    - name: "删除debezium信息"
      shell: |
        set -e
        cd ~/deployer-flash-sale/crond
        rm -rf debezium

- name: "销毁zookeeper、redis等公共服务"
  hosts: common
  tasks:
    - name: "使用Docker Compose down销毁zookeeper、redis等公共服务"
      shell: |
        set -e
        cd ~/deployer-flash-sale/common
        docker compose down -v

- name: "销毁prometheus公共服务"
  hosts: common
  tasks:
    - name: "使用Docker Compose down销毁prometheus公共服务"
      shell: |
        set -e
        cd ~/deployer-flash-sale/prometheus
        docker compose down -v

#- name: "销毁Skywalking公共服务"
#  hosts: common
#  tasks:
#    - name: "使用Docker Compose down销毁Skywalking公共服务"
#      shell: |
#        set -e
#        cd ~/deployer-flash-sale/skywalking
#        docker compose down -v

- name: "销毁数据库服务"
  hosts: db
  tasks:
    - name: "使用Docker Compose down销毁数据库服务"
      shell: |
        set -e
        cd ~/deployer-flash-sale/db
        docker compose down -v

#- name: "销毁RocketMQ服务"
#  hosts: rocketmq
#  tasks:
#    - name: "使用Docker Compose down销毁RocketMQ服务"
#      shell: |
#        set -e
#        cd ~/deployer-flash-sale/rocketmq
#        docker compose down -v
- name: "销毁Kafka服务"
  hosts: rocketmq
  tasks:
    - name: "使用Docker Compose down销毁Kafka服务"
      shell: |
        set -e
        cd ~/deployer-flash-sale/kafka
        docker compose down -v

- name: "销毁Cassandra服务"
  hosts: cassandra
  tasks:
    - name: "使用Docker Compose down销毁Cassandra服务"
      shell: |
        set -e
        cd ~/deployer-flash-sale/cassandra
        docker compose down -v

- name: "销毁OpenResty服务"
  hosts: openresty
  tasks:
    - name: "使用Docker Compose down销毁OpenResty服务"
      shell: |
        set -e
        cd ~/deployer-flash-sale/openresty
        docker compose down -v

- name: "销毁ui服务"
  hosts: common
  tasks:
    - name: "使用Docker Compose down销毁ui服务"
      shell: |
        set -e
        cd ~/deployer-flash-sale/ui
        docker compose down -v

- name: "销毁node_exporter"
  hosts: "{{ groups['all'] | difference(groups['management']) }}"
  tasks:
    - name: "使用Docker Compose down销毁node_exporter"
      shell: |
        set -e
        cd ~/deployer-flash-sale/node-exporter
        docker compose down -v
