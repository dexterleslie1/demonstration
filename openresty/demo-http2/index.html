<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTP/1.1 vs HTTP/2 æ€§èƒ½å¯¹æ¯”æµ‹è¯•</title>
    <link rel="stylesheet" href="/assets/css/style1.css">
    <link rel="stylesheet" href="/assets/css/style2.css">
    <link rel="stylesheet" href="/assets/css/style3.css">
    <link rel="stylesheet" href="/assets/css/style4.css">
    <link rel="stylesheet" href="/assets/css/style5.css">
    <link rel="stylesheet" href="/assets/css/style6.css">
    <link rel="stylesheet" href="/assets/css/style7.css">
    <link rel="stylesheet" href="/assets/css/style8.css">
    <link rel="stylesheet" href="/assets/css/style9.css">
    <link rel="stylesheet" href="/assets/css/style10.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .protocol-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric-card {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #2196F3;
        }
        .metric-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #2196F3;
            margin-top: 5px;
        }
        .images-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .image-item {
            border: 1px solid #ddd;
            padding: 5px;
            border-radius: 4px;
            text-align: center;
        }
        .image-item img {
            max-width: 100%;
            height: auto;
        }
        .loading-status {
            margin: 10px 0;
            padding: 10px;
            background: #fff3cd;
            border-radius: 4px;
        }
        .complete {
            background: #d4edda;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #45a049;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .comparison-table th {
            background: #4CAF50;
            color: white;
        }
        .comparison-table tr:nth-child(even) {
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ HTTP/1.1 vs HTTP/2 æ€§èƒ½å¯¹æ¯”æµ‹è¯•</h1>
        
        <div class="protocol-info" id="protocolInfo">
            <strong>å½“å‰åè®®:</strong> <span id="protocol">æ£€æµ‹ä¸­...</span><br>
            <strong>é¡µé¢URL:</strong> <span id="currentUrl"></span>
        </div>
        
        <div class="loading-status" id="loadingStatus">
            æ­£åœ¨åŠ è½½èµ„æº...
        </div>
        
        <div class="metrics">
            <div class="metric-card">
                <div class="metric-label">DOMContentLoaded</div>
                <div class="metric-value" id="domTime">-</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">é¡µé¢å®Œå…¨åŠ è½½</div>
                <div class="metric-value" id="loadTime">-</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">èµ„æºæ€»æ•°</div>
                <div class="metric-value" id="resourceCount">-</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">æ€»ä¼ è¾“å¤§å°</div>
                <div class="metric-value" id="totalSize">-</div>
            </div>
        </div>
        
        <h2>æµ‹è¯•å›¾ç‰‡èµ„æº</h2>
        <div class="images-container" id="imagesContainer">
            <!-- å›¾ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
        </div>
        
        <h2>æ€§èƒ½å¯¹æ¯”è¯´æ˜</h2>
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>æŒ‡æ ‡</th>
                    <th>HTTP/1.1</th>
                    <th>HTTP/2</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>è¿æ¥å¤ç”¨</td>
                    <td>å—é™ï¼ˆé€šå¸¸6ä¸ªå¹¶å‘è¿æ¥ï¼‰</td>
                    <td>å•è¿æ¥å¤šè·¯å¤ç”¨</td>
                </tr>
                <tr>
                    <td>å¤´éƒ¨å‹ç¼©</td>
                    <td>æ— </td>
                    <td>HPACKå‹ç¼©</td>
                </tr>
                <tr>
                    <td>æœåŠ¡å™¨æ¨é€</td>
                    <td>ä¸æ”¯æŒ</td>
                    <td>æ”¯æŒ</td>
                </tr>
                <tr>
                    <td>èµ„æºåŠ è½½</td>
                    <td>éœ€è¦å¤šä¸ªTCPè¿æ¥</td>
                    <td>å•TCPè¿æ¥å¹¶è¡Œ</td>
                </tr>
            </tbody>
        </table>
        
        <div style="margin-top: 30px;">
            <button onclick="location.reload()">ğŸ”„ é‡æ–°åŠ è½½æµ‹è¯•</button>
            <button onclick="window.open(window.location.href, '_blank')">ğŸ†• æ–°çª—å£æµ‹è¯•</button>
        </div>
    </div>
    
    <script src="/assets/js/script1.js"></script>
    <script src="/assets/js/script2.js"></script>
    <script src="/assets/js/script3.js"></script>
    <script src="/assets/js/script4.js"></script>
    <script src="/assets/js/script5.js"></script>
    <script src="/assets/js/script6.js"></script>
    <script src="/assets/js/script7.js"></script>
    <script src="/assets/js/script8.js"></script>
    <script src="/assets/js/script9.js"></script>
    <script src="/assets/js/script10.js"></script>
    
    <script>
        // æ€§èƒ½ç›‘æ§è„šæœ¬
        (function() {
            const protocol = window.location.protocol === 'https:' ? 'HTTP/2' : 'HTTP/1.1';
            document.getElementById('protocol').textContent = protocol;
            document.getElementById('currentUrl').textContent = window.location.href;
            
            // è·å–å¯¼èˆªå¼€å§‹æ—¶é—´ï¼ˆè¿™æ˜¯é¡µé¢å¼€å§‹åŠ è½½çš„åŸºå‡†æ—¶é—´ï¼‰
            const navigationStart = performance.timing ? performance.timing.navigationStart : performance.now();
            const startTime = performance.now();
            
            // åŠ¨æ€åŠ è½½å›¾ç‰‡èµ„æºï¼ˆæ¨¡æ‹ŸçœŸå®ç½‘é¡µåœºæ™¯ï¼‰
            const imageCount = 15;
            const imagesContainer = document.getElementById('imagesContainer');
            
            for (let i = 1; i <= imageCount; i++) {
                const imgDiv = document.createElement('div');
                imgDiv.className = 'image-item';
                const img = document.createElement('img');
                img.src = `/assets/images/img${i}.jpg`;
                img.alt = `Image ${i}`;
                img.loading = 'lazy'; // å»¶è¿ŸåŠ è½½
                imgDiv.appendChild(img);
                imagesContainer.appendChild(imgDiv);
            }
            
            // ç›‘å¬èµ„æºåŠ è½½
            let loadedResources = 0;
            const totalResources = document.querySelectorAll('link[rel="stylesheet"], script[src], img').length;
            
            function updateResourceCount() {
                loadedResources++;
                document.getElementById('resourceCount').textContent = `${loadedResources}/${totalResources}`;
            }
            
            // è®¡ç®—DOMContentLoadedæ—¶é—´ï¼ˆä½¿ç”¨performance.timing APIï¼Œä¸Chrome DevToolsä¸€è‡´ï¼‰
            function getDOMContentLoadedTime() {
                if (performance.timing && performance.timing.domContentLoadedEventEnd) {
                    return performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart;
                }
                // å¦‚æœperformance.timingä¸å¯ç”¨ï¼Œå°è¯•ä½¿ç”¨PerformanceNavigationTiming API
                if (performance.getEntriesByType) {
                    const navEntries = performance.getEntriesByType('navigation');
                    if (navEntries.length > 0 && navEntries[0].domContentLoadedEventEnd) {
                        return navEntries[0].domContentLoadedEventEnd;
                    }
                }
                return 0;
            }
            
            // æ›´æ–°DOMContentLoadedæ—¶é—´æ˜¾ç¤º
            function updateDOMContentLoadedTime() {
                const domTime = getDOMContentLoadedTime();
                if (domTime > 0) {
                    document.getElementById('domTime').textContent = domTime.toFixed(2) + ' ms';
                }
            }
            
            // æ£€æŸ¥DOMContentLoadedæ˜¯å¦å·²ç»è§¦å‘
            if (document.readyState === 'loading') {
                // DOMè¿˜åœ¨åŠ è½½ä¸­ï¼Œæ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                document.addEventListener('DOMContentLoaded', updateDOMContentLoadedTime);
            } else {
                // DOMå·²ç»åŠ è½½å®Œæˆï¼Œç›´æ¥è®¡ç®—æ—¶é—´
                updateDOMContentLoadedTime();
            }
            
            // ç›‘å¬æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ
            window.addEventListener('load', function() {
                // ç¡®ä¿DOMContentLoadedæ—¶é—´å·²æ›´æ–°
                updateDOMContentLoadedTime();
                
                // è®¡ç®—Loadæ—¶é—´
                let loadTime = 0;
                if (performance.timing && performance.timing.loadEventEnd) {
                    loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                } else {
                    loadTime = performance.now() - startTime;
                }
                
                document.getElementById('loadTime').textContent = loadTime.toFixed(2) + ' ms';
                document.getElementById('loadingStatus').textContent = 'âœ… æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆï¼';
                document.getElementById('loadingStatus').classList.add('complete');
                
                // è®¡ç®—æ€»ä¼ è¾“å¤§å°
                const entries = performance.getEntriesByType('resource');
                const totalSize = entries.reduce((sum, entry) => sum + (entry.transferSize || 0), 0);
                document.getElementById('totalSize').textContent = (totalSize / 1024).toFixed(2) + ' KB';
                
                // æ˜¾ç¤ºè¯¦ç»†çš„èµ„æºåŠ è½½ä¿¡æ¯
                const finalDomTime = getDOMContentLoadedTime();
                console.group('ğŸ“Š æ€§èƒ½åˆ†æ');
                console.log('åè®®ç‰ˆæœ¬:', protocol);
                console.log('DOMContentLoaded:', finalDomTime > 0 ? finalDomTime.toFixed(2) + ' ms' : 'N/A');
                console.log('é¡µé¢å®Œå…¨åŠ è½½:', loadTime.toFixed(2), 'ms');
                console.log('èµ„æºæ€»æ•°:', totalResources);
                console.log('æ€»ä¼ è¾“å¤§å°:', (totalSize / 1024).toFixed(2), 'KB');
                
                // åˆ†æèµ„æºåŠ è½½æ—¶é—´çº¿
                entries.forEach((entry, index) => {
                    console.log(`${index + 1}. ${entry.name.substring(entry.name.lastIndexOf('/') + 1)}: ${entry.duration.toFixed(2)}ms`);
                });
                
                // æ£€æŸ¥HTTP/2å¤šè·¯å¤ç”¨
                if (protocol === 'HTTP/2') {
                    const connections = new Set();
                    entries.forEach(entry => {
                        // åœ¨HTTP/2ä¸­ï¼Œæ‰€æœ‰èµ„æºåº”è¯¥ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥
                        connections.add(entry.name.split('/')[2]); // æå–åŸŸå
                    });
                    console.log('ä½¿ç”¨çš„è¿æ¥æ•°:', connections.size, '(HTTP/2åº”è¯¥åªæœ‰1ä¸ª)');
                } else {
                    console.log('HTTP/1.1 é€šå¸¸ä½¿ç”¨å¤šä¸ªè¿æ¥ï¼ˆæµè§ˆå™¨é™åˆ¶é€šå¸¸ä¸º6ä¸ªï¼‰');
                }
                
                console.groupEnd();
            });
            
            // ä½¿ç”¨Performance Observerç›‘å¬èµ„æºåŠ è½½
            if ('PerformanceObserver' in window) {
                const observer = new PerformanceObserver((list) => {
                    for (const entry of list.getEntries()) {
                        if (entry.entryType === 'resource') {
                            updateResourceCount();
                        }
                    }
                });
                observer.observe({ entryTypes: ['resource'] });
            }
        })();
    </script>
</body>
</html>

