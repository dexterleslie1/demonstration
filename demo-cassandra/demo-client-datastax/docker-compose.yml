version: "3.1"

services:
    node0:
      image: cassandra:3.11.4
      environment:
        - MAX_HEAP_SIZE=1G
        # 是MAX_HEAP_SIZE的1/4
        - HEAP_NEWSIZE=256M
        - CASSANDRA_SEEDS=node0
        # 节点向客户端广播的地址是宿主机可访问的 IP
        - CASSANDRA_BROADCAST_RPC_ADDRESS=${cassandra_broadcast_rpc_address}
      volumes:
        - ./init.cql:/scripts/data.cql:ro
#      network_mode: host
      ports:
        - "9042:9042"   # CQL 客户端端口
    node1:
      image: cassandra:3.11.4
      environment:
        - MAX_HEAP_SIZE=1G
        # 是MAX_HEAP_SIZE的1/4
        - HEAP_NEWSIZE=256M
        - CASSANDRA_SEEDS=node0,node1
        # 节点向客户端广播的地址是宿主机可访问的 IP
        - CASSANDRA_BROADCAST_RPC_ADDRESS=${cassandra_broadcast_rpc_address}
      ports:
        - "9043:9042"   # CQL 客户端端口
    node2:
      image: cassandra:3.11.4
      environment:
        - MAX_HEAP_SIZE=1G
        # 是MAX_HEAP_SIZE的1/4
        - HEAP_NEWSIZE=256M
        - CASSANDRA_SEEDS=node0,node1,node2
        # 节点向客户端广播的地址是宿主机可访问的 IP
        - CASSANDRA_BROADCAST_RPC_ADDRESS=${cassandra_broadcast_rpc_address}
      ports:
        - "9044:9042"   # CQL 客户端端口
