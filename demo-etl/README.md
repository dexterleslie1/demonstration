## ETL概念

**ETL** 是英文 **Extract（抽取）、Transform（转换）、Load（加载）** 的缩写，是数据处理和数据仓库领域中的一个**核心流程和关键技术**。它的主要目的是将来自多个不同来源的数据进行整合、清洗和加工，然后加载到目标系统（如数据仓库、数据库或分析平台）中，以支持后续的**数据分析、报表生成和商业智能（BI）**。

------

### 🔁 一、ETL 的三个阶段详解

| 阶段 | 英文      | 中文 | 作用                                                         |
| ---- | --------- | ---- | ------------------------------------------------------------ |
| 1️⃣    | Extract   | 抽取 | 从各种数据源（如 Excel、CSV、数据库、API、日志等）中提取原始数据 |
| 2️⃣    | Transform | 转换 | 对数据进行清洗、格式化、合并、计算、去重、聚合等处理，使其符合目标系统的要求 |
| 3️⃣    | Load      | 加载 | 将处理后的数据加载到目标存储系统（如数据仓库、OLAP 数据库、BI 工具等）中 |

------

#### 1️⃣ Extract（抽取）：把数据“拿出来”

- **数据源类型**：
  - 结构化数据：MySQL、SQL Server、Oracle 等关系型数据库
  - 半结构化数据：JSON、XML、Excel、CSV
  - 非结构化数据：文本、日志、图片（需先解析）
  - 外部接口：Web API、FTP、云服务（如 Salesforce、Google Analytics）
- **挑战**：
  - 数据源多样，格式不一
  - 数据量大，需高效读取
  - 实时性要求（批处理 vs 流式抽取）

✅ 示例：每天凌晨从公司销售系统（SQL Server）和电商平台（CSV 导出）中抽取前一天的交易数据。

------

#### 2️⃣ Transform（转换）：把数据“洗干净、整理好”

这是 ETL 中最复杂、最关键的环节，常见操作包括：

| 操作类型             | 说明                     | 示例                            |
| -------------------- | ------------------------ | ------------------------------- |
| 清洗（Cleaning）     | 去除错误、缺失、重复数据 | 删除姓名为空的记录              |
| 格式化（Formatting） | 统一日期、数字、文本格式 | 将 "2024/1/1" 转为 "2024-01-01" |
| 转换（Converting）   | 数据类型转换、单位换算   | 将金额从“分”转为“元”            |
| 合并（Merging）      | 多表关联或拼接           | 将订单表和客户表通过 ID 合并    |
| 拆分（Splitting）    | 一列拆成多列             | 将“姓名”拆分为“姓”和“名”        |
| 计算（Calculating）  | 新增派生字段             | 计算“利润 = 收入 - 成本”        |
| 聚合（Aggregating）  | 汇总数据                 | 按地区统计总销售额              |
| 过滤（Filtering）    | 保留符合条件的数据       | 只保留2024年的数据              |

✅ 示例：将销售数据和客户数据合并，补全缺失的客户等级，计算每笔订单的利润率。

------

#### 3️⃣ Load（加载）：把数据“存进去、准备好用”

- **目标系统**：
  - 数据仓库（如 Snowflake、Amazon Redshift、Google BigQuery）
  - OLAP 数据库（如 SSAS、ClickHouse）
  - BI 工具的数据模型（如 Power BI 的 Power Pivot）
  - 甚至另一个数据库或 Excel 文件
- **加载方式**：
  - **全量加载（Full Load）**：每次都覆盖全部数据（适合小数据量或初始化）
  - **增量加载（Incremental Load）**：只加载新增或变更的数据（效率高，适合日常更新）

✅ 示例：将处理好的每日销售数据追加到公司的数据仓库中，供 Power BI 报表调用。

------

### 🏗️ 二、ETL 的应用场景

| 场景             | 说明                                        |
| ---------------- | ------------------------------------------- |
| 📊 商业智能（BI） | 构建统一的数据视图，支撑报表和仪表盘        |
| 📦 数据仓库建设   | 将分散的业务数据整合为可分析的结构          |
| 🔄 系统集成       | 打通 CRM、ERP、电商等多个系统之间的数据孤岛 |
| 📈 数据分析与挖掘 | 提供干净、一致的数据集用于分析和建模        |
| 🤖 机器学习       | 为 AI 模型提供高质量的训练数据              |

------

### 🛠️ 三、常见的 ETL 工具

| 工具                | 类型                   | 特点                               |
| ------------------- | ---------------------- | ---------------------------------- |
| **Power Query**     | 微软（Excel/Power BI） | 轻量级、图形化、适合办公用户       |
| **Alteryx**         | 商业软件               | 拖拽式工作流，适合业务分析师       |
| **Talend**          | 开源/商业              | 支持大数据和企业级 ETL             |
| **Informatica**     | 企业级商业软件         | 功能强大，适合大型组织             |
| **Apache NiFi**     | 开源                   | 支持数据流自动化，适合 IT 团队     |
| **Airflow + dbt**   | 开源组合               | 现代数据栈（ELT 模式），开发者友好 |
| **Python + Pandas** | 编程方式               | 灵活强大，适合定制化需求           |

> 💡 注意：现代趋势逐渐从 **ETL** 转向 **ELT**（Extract → Load → Transform），即先把原始数据加载到数据仓库，再用 SQL 或工具（如 dbt）在库中转换，更适合云时代的大数据场景。

------

### 🎯 四、ETL 的重要性

- ✅ **打破数据孤岛**：整合多个系统数据
- ✅ **提高数据质量**：统一标准、减少错误
- ✅ **支持决策分析**：让管理者看到准确、及时的业务洞察
- ✅ **自动化流程**：减少人工导出、复制、粘贴的错误和耗时

------

### 🧠 举个通俗的例子 🌰

想象你在开一家连锁餐厅：

- **Extract**：你从各个分店收集每天的收银小票（Excel）、外卖平台数据（API）、会员系统（数据库）。
- **Transform**：你把不同格式的销售额统一成“元”，去掉测试订单，合并会员信息，计算每家店的日均营业额。
- **Load**：你把整理好的数据放进一个中央数据库，老板打开 BI 看板就能看到全国门店的经营情况。

👉 这个过程就是一次典型的 **ETL**。

------

### ✅ 总结

> **ETL 是数据处理的“搬运+加工+上架”全过程，是连接原始业务系统和数据分析应用的桥梁。**

它是现代数据驱动型企业不可或缺的基础设施，广泛应用于金融、零售、电商、医疗、互联网等行业。

掌握 ETL 思维（即使不用专业工具），也能极大提升你处理数据的效率和质量。

## Power Query概念

**Power Query** 是由微软开发的一款**数据连接、转换与整合工具**，主要用于从各种来源获取数据，并进行清洗、合并、重塑等处理，最终输出为可用的结构化数据。它被广泛应用于 **Excel**、**Power BI**、**Power Apps** 和 **Analysis Services** 等微软生态产品中，是**自助式商业智能（Self-Service BI）** 和 **现代数据分析** 的核心组件之一。

------

### 🔍 一、Power Query 是什么？（一句话定义）

> **Power Query 是一个图形化的数据准备工具，让你无需编写复杂代码，就能轻松连接、清洗和整合来自多个来源的数据，并支持一键刷新。**

它解决了传统 Excel 在处理多源数据、重复操作、大数据量时的痛点。

------

### 🧩 二、Power Query 的核心功能

| 功能                        | 说明                                                         |
| --------------------------- | ------------------------------------------------------------ |
| 🔗 **数据连接（Get Data）**  | 支持从数百种数据源获取数据，包括 Excel、CSV、数据库（SQL Server、MySQL 等）、Web 页面、PDF、SharePoint、Azure、Salesforce、OData 等。 |
| 🧹 **数据清洗（Transform）** | 删除空行、填充缺失值、更改数据类型、拆分列、合并列、筛选、排序、透视/逆透视等。 |
| 🔄 **数据整合（Combine）**   | 合并多个表格（Merge）、追加数据（Append，类似 SQL UNION ALL）、跨工作簿合并 Sheet。 |
| 🪄 **自动化流程**            | 操作步骤自动记录并可重复使用，修改源数据后只需“刷新”即可更新结果。 |
| 📜 **M 语言支持**            | 所有操作背后由 **Power Query M 公式语言** 驱动，高级用户可编辑代码实现更复杂逻辑。 |
| 💾 **输出到多种目标**        | 可将结果加载到 Excel 表格、Power Pivot 数据模型、CSV 或直接用于图表。 |

------

### 🖥️ 三、Power Query 在哪里使用？

| 产品                                    | 入口名称                              | 说明                       |
| --------------------------------------- | ------------------------------------- | -------------------------- |
| **Excel**（2016 及以上）                | 「数据」→「获取数据」/「从表格/范围」 | 最常用的入口，适合办公场景 |
| **Power BI Desktop**                    | 「主页」→「获取数据」                 | BI 报表的核心数据准备工具  |
| **Power Apps**                          | 用于构建应用的数据源配置              | 支持动态数据加载           |
| **SQL Server Analysis Services (SSAS)** | Tabular 模型中使用                    | 企业级数据建模             |

> 💡 注意：无论在哪个产品中，**Power Query 的界面和操作逻辑基本一致**，学会一个即可迁移。

------

### 🎯 四、Power Query 的典型应用场景

| 场景                  | 示例                                                 |
| --------------------- | ---------------------------------------------------- |
| 📂 合并多个 Excel 文件 | 每月销售报表分散在不同文件中，一键合并为一个总表     |
| 🧮 清洗杂乱数据        | 从系统导出的数据中有多余空格、不一致的格式，自动清理 |
| 🌐 抓取网页数据        | 从财经网站抓取股票行情或汇率数据（Web 查询）         |
| 🔄 定期刷新报表        | 设置好流程后，每周自动更新数据，无需手动复制粘贴     |
| 🧩 多表关联分析        | 将订单表和客户表合并，添加客户等级字段用于分析       |
| 📊 构建数据模型        | 在 Power BI 中用 Power Query 准备事实表和维度表      |

------

### ⚙️ 五、Power Query 的工作原理（三步流程）

1. **获取数据（Get Data）**

   选择数据源并建立连接。

2. **编辑查询（Edit Queries）**

   在“Power Query 编辑器”中以图形化方式设置转换步骤（每一步都会保存）。

3. **加载数据（Load）**

   将处理后的数据加载回 Excel 或数据模型，并可设置“启用刷新”。

> ✅ 所有操作被记录为**可重放的查询步骤**，下次源数据变化时，只需点击“刷新”即可自动重复整个过程。

------

### 💬 六、背后的语言：M 语言（Power Query Formula Language）

- Power Query 的所有操作最终都会被翻译成 **M 语言**（一种函数式编程语言）。

- 用户可以在高级模式下查看或编辑 M 代码，实现更复杂的逻辑（如条件判断、循环、自定义函数等）。

- 示例 M 代码片段：

  ```
  let
      Source = Excel.CurrentWorkbook(){[Name="Sales"]}[Content],
      RemovedBlanks = Table.SelectRows(Source, each List.NonNullCount(Record.ToList(_)) > 0)
  in
      RemovedBlanks
  ```

> 🟢 普通用户可只用图形界面，进阶用户可用 M 语言提升灵活性和复用性。

------

### ✅ 七、Power Query 的优势

| 优势             | 说明                                             |
| ---------------- | ------------------------------------------------ |
| 🖱️ **图形化操作** | 拖拽、点击即可完成复杂操作，降低技术门槛         |
| 🔁 **可重复性**   | 设置一次，永久使用，支持自动刷新                 |
| 🌍 **多源支持**   | 支持几乎所有常见数据源                           |
| 💡 **智能推荐**   | 自动检测数据类型、列拆分建议等                   |
| 🔐 **安全连接**   | 支持 OAuth、Windows 认证等安全机制               |
| 🆓 **免费使用**   | 随 Office 365 / Excel 2016+ 免费提供（基础功能） |

------

### ⚠️ 八、局限性与注意事项

- ❌ 不适合超大规模数据（百万级以上建议用 Power BI 或数据库）
- ❌ 复杂业务逻辑可能仍需借助 VBA 或编程（如 Python）
- ⚠️ 刷新依赖源文件路径或网络连接（移动文件可能导致失效）
- ⚠️ 部分高级功能仅在 Power BI 中可用（如参数化查询、自定义函数共享）

------

### 🧠 九、类比理解：Power Query 像什么？

| 类比                  | 解释                                                         |
| --------------------- | ------------------------------------------------------------ |
| 🧽 数据“洗碗机”        | 把脏乱的原始数据（脏碗）清洗、整理成干净可用的数据（干净餐具） |
| 🏭 数据“流水线”        | 设定好流程后，源源不断输入原料，输出标准化产品               |
| 📸 照片“滤镜+裁剪”工具 | 你不需要懂摄影，点几下就能美化照片；同理，不懂编程也能处理数据 |

------

### ✅ 总结：Power Query 是什么？

> **Power Query 是一款强大的“数据准备神器”，它让用户（尤其是非程序员）能够轻松连接、清洗和整合多源数据，并通过自动化流程大幅提升工作效率。它是现代 Excel 和 Power BI 的灵魂工具之一，标志着“人人都能做数据分析”成为可能。**

📌 一句话记住：

> **“以前手动复制粘贴几小时，现在用 Power Query 几分钟搞定，还能自动更新！”**

------

如果你经常处理 Excel 或多源数据，学习 Power Query 将是**性价比最高的技能投资之一**。