# `mysql`å‘½ä»¤



## `show processlist`å‘½ä»¤

>[SHOW PROCESSLIST Statement](https://dev.mysql.com/doc/refman/8.4/en/show-processlist.html)

å¦‚æœæ²¡æœ‰ FULL å…³é”®å­—ï¼ŒSHOW PROCESSLIST åªä¼šåœ¨`Info`å­—æ®µä¸­æ˜¾ç¤ºæ¯ä¸ªè¯­å¥çš„å‰ 100 ä¸ªå­—ç¬¦ã€‚

```sql
show processlist;
```

`SHOW PROCESSLIST`è¾“å‡ºåŒ…å«ä»¥ä¸‹åˆ—ï¼š

- `Id`

  è¿æ¥æ ‡è¯†ç¬¦ã€‚æ­¤å€¼ä¸ INFORMATION_SCHEMA PROCESSLIST è¡¨çš„ ID åˆ—ä¸­æ˜¾ç¤ºçš„å€¼ã€æ€§èƒ½æ¨¡å¼çº¿ç¨‹è¡¨çš„ PROCESSLIST_ID åˆ—ä¸­æ˜¾ç¤ºçš„å€¼ä»¥åŠçº¿ç¨‹å†…çš„ CONNECTION_ID() å‡½æ•°è¿”å›çš„å€¼ç›¸åŒã€‚

- `User`

  å‘å‡ºè¯­å¥çš„ MySQL ç”¨æˆ·ã€‚ç³»ç»Ÿç”¨æˆ·å€¼æ˜¯æŒ‡æœåŠ¡å™¨ç”Ÿæˆçš„éå®¢æˆ·ç«¯çº¿ç¨‹ï¼Œç”¨äºå†…éƒ¨å¤„ç†ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼Œå»¶è¿Ÿè¡Œå¤„ç†ç¨‹åºçº¿ç¨‹æˆ–å‰¯æœ¬ä¸»æœºä¸Šä½¿ç”¨çš„ I/Oï¼ˆæ¥æ”¶å™¨ï¼‰æˆ– SQLï¼ˆåº”ç”¨ç¨‹åºï¼‰çº¿ç¨‹ã€‚å¯¹äºç³»ç»Ÿç”¨æˆ·ï¼ŒHost åˆ—ä¸­æœªæŒ‡å®šä¸»æœºã€‚æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·æ˜¯æŒ‡å·²ä¸å®¢æˆ·ç«¯è¿æ¥å…³è”ä½†å°šæœªå¯¹å®¢æˆ·ç«¯ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯çš„çº¿ç¨‹ã€‚event_scheduler æ˜¯æŒ‡ç›‘è§†è®¡åˆ’äº‹ä»¶çš„çº¿ç¨‹

- `Host`

  å‘å‡ºè¯­å¥çš„å®¢æˆ·ç«¯çš„ä¸»æœºåï¼ˆç³»ç»Ÿç”¨æˆ·é™¤å¤–ï¼Œå› ä¸ºç³»ç»Ÿç”¨æˆ·æ²¡æœ‰ä¸»æœºï¼‰ã€‚TCP/IP è¿æ¥çš„ä¸»æœºåä»¥ host_name:client_port æ ¼å¼æŠ¥å‘Šï¼Œä»¥ä¾¿äºç¡®å®šå“ªä¸ªå®¢æˆ·ç«¯æ­£åœ¨æ‰§è¡Œä»€ä¹ˆæ“ä½œã€‚

- `db`

  çº¿ç¨‹çš„é»˜è®¤æ•°æ®åº“ï¼Œå¦‚æœæœªé€‰æ‹©åˆ™ä¸º NULLã€‚

- `Command`

  çº¿ç¨‹ä»£è¡¨å®¢æˆ·ç«¯æ‰§è¡Œçš„å‘½ä»¤ç±»å‹ï¼Œå¦‚æœä¼šè¯å¤„äºç©ºé—²çŠ¶æ€ï¼Œåˆ™ä¸º Sleepã€‚æ­¤åˆ—çš„å€¼å¯¹åº”äºå®¢æˆ·ç«¯/æœåŠ¡å™¨åè®®çš„ COM_xxx å‘½ä»¤å’Œ Com_xxx çŠ¶æ€å˜é‡ã€‚

- `Time`

  çº¿ç¨‹å¤„äºå½“å‰çŠ¶æ€çš„æ—¶é—´ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰ã€‚å¯¹äºå‰¯æœ¬ SQL çº¿ç¨‹ï¼Œè¯¥å€¼æ˜¯ä¸Šæ¬¡å¤åˆ¶äº‹ä»¶çš„æ—¶é—´æˆ³ä¸å‰¯æœ¬ä¸»æœºçš„å®é™…æ—¶é—´ä¹‹é—´çš„ç§’æ•°ã€‚

- `State`

  æŒ‡ç¤ºçº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ“ä½œã€äº‹ä»¶æˆ–çŠ¶æ€ã€‚

   å¤§å¤šæ•°çŠ¶æ€å¯¹åº”äºéå¸¸å¿«é€Ÿçš„æ“ä½œã€‚å¦‚æœçº¿ç¨‹åœ¨ç»™å®šçŠ¶æ€ä¸‹åœç•™æ•°ç§’ï¼Œåˆ™å¯èƒ½å­˜åœ¨éœ€è¦è°ƒæŸ¥çš„é—®é¢˜ã€‚

- `Info`

  çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„è¯­å¥ï¼Œå¦‚æœæœªæ‰§è¡Œä»»ä½•è¯­å¥ï¼Œåˆ™ä¸º NULLã€‚è¯¥è¯­å¥å¯èƒ½æ˜¯å‘é€åˆ°æœåŠ¡å™¨çš„è¯­å¥ï¼Œæˆ–è€…å¦‚æœè¯¥è¯­å¥æ‰§è¡Œå…¶ä»–è¯­å¥ï¼Œåˆ™ä¸ºæœ€å†…å±‚çš„è¯­å¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ CALL è¯­å¥æ‰§è¡Œæ­£åœ¨æ‰§è¡Œ SELECT è¯­å¥çš„å­˜å‚¨è¿‡ç¨‹ï¼Œåˆ™ Info å€¼æ˜¾ç¤º SELECT è¯­å¥ã€‚



## `show profiles`å’Œ`show profile`å‘½ä»¤

>[SHOW PROFILE Statement](https://dev.mysql.com/doc/refman/8.4/en/show-profile.html)

**Show Profileså¹¶ä¸æ˜¯é’ˆå¯¹å…¨å±€çš„**ï¼Œè€Œæ˜¯é’ˆå¯¹å½“å‰ä¼šè¯ï¼ˆsessionï¼‰çš„ã€‚è¿™æ„å‘³ç€ï¼Œå½“ä½ åœ¨MySQLä¸­å¯ç”¨å¹¶ä½¿ç”¨äº†Show ProfilesåŠŸèƒ½æ—¶ï¼Œå®ƒåªä¼šè®°å½•å¹¶åˆ†æå½“å‰ä¼šè¯ä¸­æ‰§è¡Œçš„SQLè¯­å¥çš„èµ„æºæ¶ˆè€—æƒ…å†µï¼Œè€Œä¸ä¼šå½±å“åˆ°å…¶ä»–ä¼šè¯æˆ–æ•´ä¸ªMySQLå®ä¾‹ã€‚

å…·ä½“æ¥è¯´ï¼ŒShow Profilesæ˜¯MySQLæä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œå¯ä»¥ç”¨æ¥åˆ†æSQLè¯­å¥æ‰§è¡Œçš„èµ„æºæ¶ˆè€—æƒ…å†µï¼Œå¦‚IOã€ä¸Šä¸‹æ–‡åˆ‡æ¢ã€CPUã€å†…å­˜ç­‰ï¼Œä»è€Œå¸®åŠ©è¿›è¡ŒSQLè°ƒä¼˜ã€‚ç„¶è€Œï¼Œè¿™ä¸ªåŠŸèƒ½é»˜è®¤æ˜¯å…³é—­çš„ï¼Œå¹¶ä¸”å®ƒåªä¼šåœ¨å½“å‰ä¼šè¯ä¸­è®°å½•æœ€è¿‘æ‰§è¡Œçš„SQLè¯­å¥çš„èµ„æºæ¶ˆè€—æƒ…å†µï¼Œæ•°é‡é€šå¸¸æ˜¯æœ‰é™çš„ï¼ˆå¦‚æœ€è¿‘15æ¬¡ï¼‰ã€‚

æŸ¥çœ‹å½“å‰æ•°æ®åº“æ˜¯å¦æ”¯æŒ`profiling`

```sql
select @@have_profiling;
```

åˆ¤æ–­`profiling`å¼€å…³æ˜¯å¦å¼€å¯

```sql
select @@profiling;
```

å¼€å¯`profiling`åŠŸèƒ½

```sql
set profiling=1;
```

æŸ¥çœ‹æ˜¯å¦æˆåŠŸå¼€å¯`profiling`

```sql
select @@profiling;
```

SHOW PROFILES æ˜¾ç¤ºå‘é€åˆ°æœåŠ¡å™¨çš„æœ€æ–°è¯­å¥åˆ—è¡¨ã€‚åˆ—è¡¨çš„å¤§å°ç”± profiling_history_size ä¼šè¯å˜é‡æ§åˆ¶ï¼Œå…¶é»˜è®¤å€¼ä¸º 15ã€‚æœ€å¤§å€¼ä¸º 100ã€‚å°†è¯¥å€¼è®¾ç½®ä¸º 0 å¯å®é™…ç¦ç”¨åˆ†æ

```sql
# æ˜¾ç¤ºprofiling_history_sizeä¼šè¯å˜é‡
select @@profiling_history_size;

# è®¾ç½®profiling_history_sizeä¼šè¯å˜é‡
set @@profiling_history_size=100;
```

æŸ¥çœ‹æ¯ä¸€æ¡`SQL`çš„è€—æ—¶æƒ…å†µ

```bash
mysql> show profiles;
+----------+------------+-----------------------+
| Query_ID | Duration   | Query                 |
+----------+------------+-----------------------+
|        1 | 0.00043900 | select @@profiling    |
|        2 | 0.00028625 | select * from tb_user |
|        3 | 0.00050750 | SELECT DATABASE()     |
|        4 | 0.00485225 | show databases        |
|        5 | 0.00383850 | show tables           |
|        6 | 0.00097625 | select * from tb_user |
+----------+------------+-----------------------+
6 rows in set, 1 warning (0.00 sec)
```

æŸ¥çœ‹æŒ‡å®š`query id`çš„`SQL`è¯­å¥å„ä¸ªé˜¶æ®µçš„è€—æ—¶æƒ…å†µ

```shell
mysql> show profile for query 6;
+--------------------------------+----------+
| Status                         | Duration |
+--------------------------------+----------+
| starting                       | 0.000345 |
| Executing hook on transaction  | 0.000012 |
| starting                       | 0.000024 |
| checking permissions           | 0.000014 |
| Opening tables                 | 0.000076 |
| init                           | 0.000017 |
| System lock                    | 0.000029 |
| optimizing                     | 0.000011 |
| statistics                     | 0.000036 |
| preparing                      | 0.000038 |
| executing                      | 0.000176 |
| end                            | 0.000011 |
| query end                      | 0.000008 |
| waiting for handler commit     | 0.000018 |
| closing tables                 | 0.000018 |
| freeing items                  | 0.000039 |
| cleaning up                    | 0.000105 |
+--------------------------------+----------+
17 rows in set, 1 warning (0.00 sec)
```

æŸ¥çœ‹æŒ‡å®š`query id`çš„`SQL cpu`çš„ä½¿ç”¨æƒ…å†µ

```bash
mysql> show profile cpu for query 6;
+--------------------------------+----------+----------+------------+
| Status                         | Duration | CPU_user | CPU_system |
+--------------------------------+----------+----------+------------+
| starting                       | 0.000345 | 0.000083 |   0.000108 |
| Executing hook on transaction  | 0.000012 | 0.000004 |   0.000006 |
| starting                       | 0.000024 | 0.000011 |   0.000014 |
| checking permissions           | 0.000014 | 0.000006 |   0.000008 |
| Opening tables                 | 0.000076 | 0.000045 |   0.000059 |
| init                           | 0.000017 | 0.000008 |   0.000010 |
| System lock                    | 0.000029 | 0.000012 |   0.000016 |
| optimizing                     | 0.000011 | 0.000005 |   0.000006 |
| statistics                     | 0.000036 | 0.000016 |   0.000021 |
| preparing                      | 0.000038 | 0.000016 |   0.000021 |
| executing                      | 0.000176 | 0.000089 |   0.000118 |
| end                            | 0.000011 | 0.000005 |   0.000005 |
| query end                      | 0.000008 | 0.000003 |   0.000005 |
| waiting for handler commit     | 0.000018 | 0.000008 |   0.000010 |
| closing tables                 | 0.000018 | 0.000008 |   0.000010 |
| freeing items                  | 0.000039 | 0.000016 |   0.000022 |
| cleaning up                    | 0.000105 | 0.000046 |   0.000060 |
+--------------------------------+----------+----------+------------+
17 rows in set, 1 warning (0.01 sec)
```

æ˜¾ç¤ºæœ€è¿‘ä¸€å¥`sql`æ‰€æœ‰åˆ—ï¼Œ`all`è¡¨ç¤ºæ˜¾ç¤ºæ‰€æœ‰åˆ—

```sql
show profile all;
```

`BLOCK IO`æ˜¾ç¤ºå—è¾“å…¥å’Œè¾“å‡ºæ“ä½œçš„è®¡æ•°

```sql
show profile block io;
```

`CONTEXT SWITCHES` æ˜¾ç¤ºè‡ªæ„¿å’Œéè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢çš„è®¡æ•°

```sql
show profile context switches;
```

`CPU` æ˜¾ç¤ºç”¨æˆ·å’Œç³»ç»Ÿ CPU ä½¿ç”¨æ—¶é—´

```sql
show profile cpu;
```

`IPC` æ˜¾ç¤ºå‘é€å’Œæ¥æ”¶çš„æ¶ˆæ¯æ•°é‡

```sql
show profile ipc;
```

`MEMORY` ç›®å‰å°šæœªå®æ–½

```sql
show profile memory;
```

`PAGE FAULTS` æ˜¾ç¤ºä¸»è¦å’Œæ¬¡è¦é¡µé¢é”™è¯¯çš„è®¡æ•°

```sql
show profile page faults;
```

`SOURCE` æ˜¾ç¤ºæºä»£ç ä¸­çš„å‡½æ•°åç§°ï¼Œä»¥åŠè¯¥å‡½æ•°æ‰€åœ¨çš„æ–‡ä»¶çš„åç§°å’Œè¡Œå·

```sql
show profile source;
```

`SWAPS` æ˜¾ç¤ºäº¤æ¢è®¡æ•°

```sql
show profile swaps;
```

è¿˜å¯ä»¥ä»[`INFORMATION_SCHEMA PROFILING`](https://dev.mysql.com/doc/refman/8.4/en/information-schema-profiling-table.html)è¡¨è·å–åˆ†æä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹æŸ¥è¯¢æ˜¯ç­‰æ•ˆçš„ï¼š

```sql
SHOW PROFILE FOR QUERY 2;

SELECT STATE, FORMAT(DURATION, 6) AS DURATION
FROM INFORMATION_SCHEMA.PROFILING
WHERE QUERY_ID = 2 ORDER BY SEQ;
```



## `explain`å‘½ä»¤

>[MySQL explain åº”ç”¨è¯¦è§£](https://segmentfault.com/a/1190000023565685)
>
>[MySQL EXPLAIN è¯¦è§£ï¼Œå¯ç”¨EXPLAINæ¥åˆ†æä¼˜åŒ–æ•°æ®åº“sqlè¯­å¥](https://www.kancloud.cn/xuwenyang/php_standard/2707424)

- åˆ›å»ºæµ‹è¯•æ•°æ®åº“

  ```sql
  CREATE DATABASE `mydb`;
  
  USE `mydb`;
  
  DROP TABLE IF EXISTS `course`;
  
  CREATE TABLE `course` (
    `id` int(10) NOT NULL AUTO_INCREMENT,
    `name` varchar(20) DEFAULT NULL,
    PRIMARY KEY (`id`)
  ) ENGINE=InnoDB AUTO_INCREMENT=21 DEFAULT CHARSET=utf8;
  
  insert  into `course`(`id`,`name`) values 
  (1,'è¯­æ–‡'),(2,'é«˜ç­‰æ•°å­¦'),(3,'è§†å¬è¯´'),(4,'ä½“è‚²'),(5,'é©¬å…‹æ€æ¦‚å†µ'),(6,'æ°‘æ—ç†è®º'),(7,'æ¯›ä¸­ç‰¹'),(8,'è®¡ç®—æœºåŸºç¡€'),(9,'æ·±åº¦å­¦ä¹ '),(10,'Javaç¨‹åºè®¾è®¡'),(11,'cè¯­è¨€ç¨‹åºè®¾è®¡'),(12,'æ“ä½œç³»ç»Ÿ'),(13,'è®¡ç®—æœºç½‘ç»œ'),(14,'è®¡ç®—æœºç»„æˆåŸç†'),(15,'æ•°æ®ç»“æ„'),(16,'æ•°æ®åˆ†æ'),(17,'å¤§å­¦ç‰©ç†'),(18,'æ•°å­—é€»è¾‘'),(19,'åµŒå…¥å¼å¼€å‘'),(20,'éœ€æ±‚å·¥ç¨‹');
  
  DROP TABLE IF EXISTS `stu_course`;
  
  CREATE TABLE `stu_course` (
    `sid` int(10) NOT NULL,
    `cid` int(10) NOT NULL,
    PRIMARY KEY (`sid`,`cid`)
  ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
  
  insert  into `stu_course`(`sid`,`cid`) values 
  (1,2),(1,4),(1,14),(1,16),(1,19),(2,4),(2,8),(2,9),(2,14),(3,13),(3,14),(3,20),(4,5),(4,8),(4,9),(4,11),(4,16),(5,4),(5,8),(5,9),(5,11),(5,12),(5,16),(6,2),(6,14),(6,17),(7,1),(7,8),(7,15),(8,2),(8,3),(8,7),(8,17),(9,1),(9,7),(9,16),(9,20),(10,4),(10,12),(10,14),(10,20),(11,3),(11,9),(11,16),(12,3),(12,7),(12,9),(12,12),(13,1),(13,5),(13,13),(14,1),(14,3),(14,18),(15,1),
  (15,9),(15,15),(16,2),(16,7);
  
  DROP TABLE IF EXISTS `student`;
  
  CREATE TABLE `student` (
    `id` int(10) NOT NULL AUTO_INCREMENT,
    `name` varchar(20) DEFAULT NULL,
    `age` int(2) DEFAULT NULL,
    PRIMARY KEY (`id`),
    KEY `name` (`name`),
    KEY `name_age` (`name`,`age`),
    KEY `id_name_age` (`id`,`name`,`age`)
  ) ENGINE=InnoDB AUTO_INCREMENT=31 DEFAULT CHARSET=utf8;
  
  insert  into `student`(`id`,`name`,`age`) values 
  (25,'ä¹¾éš†',17),(14,'å…³ç¾½',43),(13,'åˆ˜å¤‡',12),(28,'åˆ˜æ°¸',12),(21,'åè£”',12),(30,'å•å­ä¹”',28),(18,'å¬´æ”¿',76),(22,'å­™æ‚Ÿç©º',21),(4,'å®‰å…¶æ‹‰',24),(6,'å®‹æ±Ÿ',22),(26,'åº·ç†™',51),(29,'å¼ ä¼Ÿ',26),(20,'å¼ éƒƒ',12),(12,'å¼ é£',32),(27,'æœ±å…ƒç’‹',19),(11,'æä¸–æ°‘',54),(9,'æé€µ',12),(8,'æ—å†²',43),(5,'æ©˜å³äº¬',43),(24,'æ²™å’Œå°š',25),(23,'çŒªå…«æˆ’',22),(15,'ç‹ä¸',21),(19,'ç‹å»º',23),(10,'ç‹è½',43),(16,'ç§¦å”å®',43),(17,'ç¨‹å’¬é‡‘',65),(3,'è†è½²',21),(2,'è¯¸è‘›äº®',71),(7,'é’Ÿé¦—',23),(1,'é²ç­',21);
  ```

- `id`ä¸`table`å­—æ®µ

  ä¸ºä»€ä¹ˆè¦å°†`id`å’Œ`table`æ”¾åœ¨ä¸€èµ·è®²å‘¢ï¼Ÿå› ä¸ºé€šè¿‡è¿™ä¸¤ä¸ªå­—æ®µå¯ä»¥**å®Œå…¨**åˆ¤æ–­å‡ºä½ çš„æ¯ä¸€æ¡SQLè¯­å¥çš„æ‰§è¡Œé¡ºåºå’Œè¡¨çš„æŸ¥è¯¢é¡ºåºã€‚

  å…ˆçœ‹`id`åçœ‹`table`ï¼Œ`id`å’Œ`table`åœ¨SQLæ‰§è¡Œåˆ¤æ–­è¿‡ç¨‹ä¸­çš„å…³ç³»å°±åƒæ˜¯è¶³çƒè”èµ›çš„ç§¯åˆ†æ¦œï¼Œé¦–å…ˆä¸€ä¸ªè”èµ›çš„çƒé˜Ÿæ’ååº”è¯¥å…ˆçœ‹ç§¯åˆ†ï¼Œç§¯åˆ†è¶Šé«˜çš„çƒé˜Ÿæ’åè¶Šé å‰ï¼Œå½“ä¸¤æ”¯æˆ–å¤šåªçƒé˜Ÿçš„ç§¯åˆ†ä¸€æ ·é«˜æ€ä¹ˆåŠå‘¢ï¼Ÿé‚£æˆ‘ä»¬å°±çœ‹å‡€èƒœçƒï¼Œå‡€èƒœçƒè¶Šå¤šçš„çƒé˜Ÿï¼Œæ’åœ¨å‰é¢ã€‚è€Œåœ¨`explain`ä¸­ä½ å¯ä»¥æŠŠidçœ‹ä½œæ˜¯çƒé˜Ÿç§¯åˆ†ï¼Œ`table`å½“ä½œæ˜¯å‡€èƒœçƒã€‚

  æ¯”å¦‚è¯´æˆ‘ä»¬`explain`ä¸€ä¸‹è¿™ä¸€æ¡SQLï¼š

  ```sql
  EXPLAIN
  SELECT 
      S.id,S.name,S.age,C.id,C.name
  FROM course C JOIN stu_course SC ON C.id = SC.cid
  JOIN student S ON S.id = SC.sid;
  ```

  ç»“æœæ˜¯è¿™æ ·ï¼š

  ```sql
  +------+-------------+-------+--------+---------------------+----------+---------+-------------+------+-------------+
  | id   | select_type | table | type   | possible_keys       | key      | key_len | ref         | rows | Extra       |
  +------+-------------+-------+--------+---------------------+----------+---------+-------------+------+-------------+
  |    1 | SIMPLE      | S     | index  | PRIMARY,id_name_age | name_age | 68      | NULL        | 30   | Using index |
  |    1 | SIMPLE      | SC    | ref    | PRIMARY             | PRIMARY  | 4       | mydb.S.id   | 1    | Using index |
  |    1 | SIMPLE      | C     | eq_ref | PRIMARY             | PRIMARY  | 4       | mydb.SC.cid | 1    |             |
  +------+-------------+-------+--------+---------------------+----------+---------+-------------+------+-------------+
  ```

  æˆ‘ä»¬çœ‹åˆ°`id`å…¨æ˜¯1ï¼Œé‚£å°±è¯´æ˜å…‰çœ‹idè¿™ä¸ªå€¼æ˜¯çœ‹ä¸å‡ºæ¥æ¯ä¸ªè¡¨çš„è¯»å–é¡ºåºçš„ï¼Œé‚£æˆ‘ä»¬å°±æ¥çœ‹`table`è¿™ä¸€è¡Œï¼Œå®ƒçš„è¯»å–é¡ºåºæ˜¯**è‡ªä¸Šå‘ä¸‹**çš„ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸‰ä¸ªè¡¨çš„è¯»å–é¡ºåºåº”å½“æ˜¯ï¼šS - SC - Cã€‚

  å†æ¥çœ‹ä¸€æ¡SQL

  ```sql
  EXPLAIN
  SELECT * 
  FROM course AS C 
  WHERE C.`id` = (
      SELECT SC.`cid` 
      FROM stu_course AS SC 
      WHERE SC.`sid` = 
      (
          SELECT 
              S.`id` 
          FROM student AS S
          WHERE  S.`name` = "å®‰å…¶æ‹‰"
      ) ORDER BY SC.`cid` LIMIT 1
  );
  ```

  è¿™æ¡è¯­å¥æ˜¯æŸ¥è¯¢ç»“æœæ˜¯ï¼šä¸€ä¸ªå«å®‰å…¶æ‹‰çš„å­¦ç”Ÿé€‰çš„è¯¾é‡Œé¢ï¼Œè¯¾ç¨‹`id`æœ€å°çš„ä¸€é—¨è¯¾çš„ä¿¡æ¯ï¼Œç„¶åæ¥çœ‹ä¸€ä¸‹`explain`çš„ç»“æœå§ï¼

  ```sql
  +------+-------------+-------+-------+---------------+---------+---------+-------+------+--------------------------+
  | id   | select_type | table | type  | possible_keys | key     | key_len | ref   | rows | Extra                    |
  +------+-------------+-------+-------+---------------+---------+---------+-------+------+--------------------------+
  |    1 | PRIMARY     | C     | const | PRIMARY       | PRIMARY | 4       | const | 1    | Using where              |
  |    2 | SUBQUERY    | SC    | ref   | PRIMARY       | PRIMARY | 4       | const | 5    | Using where; Using index |
  |    3 | SUBQUERY    | S     | ref   | name,name_age | name    | 63      | const | 1    | Using where; Using index |
  +------+-------------+-------+-------+---------------+---------+---------+-------+------+--------------------------+
  ```

  æ­¤æ—¶æˆ‘ä»¬å‘ç°idæ˜¯ä¸ç›¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾ˆå®¹æ˜“å°±çœ‹å‡ºè¡¨è¯»å–çš„é¡ºåºäº†æ˜¯å§ï¼S - SC - C

  æ³¨æ„ï¼ï¼ï¼ï¼ï¼ï¼ä½ ä»”ç»†çœ‹ä¸€ä¸‹æœ€é‡Œé¢çš„å­æŸ¥è¯¢æ˜¯æŸ¥è¯¢çš„å“ªä¸ªè¡¨ï¼Œæ˜¯Sè¿™å¼ è¡¨ï¼Œç„¶åå¤–é¢ä¸€å±‚å‘¢ï¼Ÿæ˜¯SCè¿™å¼ è¡¨ï¼Œæœ€å¤–é¢è¿™ä¸€å±‚å‘¢ï¼Ÿæ˜¯Cè¿™å¼ è¡¨ï¼Œæ‰€ä»¥æ‰§è¡Œé¡ºåºåº”è¯¥æ˜¯å•¥å‘¢ï¼Ÿæ˜¯....æ˜¯.....éš¾é“æ˜¯S - SC - Cå—ï¼Ÿæ˜¯`id`è¶Šå¤§çš„`table`è¯»å–è¶Šåœ¨å‰é¢å—ï¼Ÿæ˜¯çš„ï¼è¿™å°±åƒåˆšæ‰è¯´çš„è¶³çƒè”èµ›ç§¯åˆ†ï¼Œåˆ†æ•°è¶Šé«˜çš„çƒé˜Ÿçš„æ’åºè¶Šé å‰ã€‚

  å½“ç„¶è¿˜æœ‰ä¸‹é¢è¿™ç§æƒ…å†µ

  ```sql
  EXPLAIN
  SELECT * 
  FROM course AS C 
  WHERE C.`id` IN (
      SELECT SC.`cid` 
      FROM stu_course AS SC 
      WHERE SC.`sid` = 
      (
          SELECT 
              S.`id` 
          FROM student AS S
          WHERE  S.`name` = "å®‰å…¶æ‹‰"
      )
  );
  ```

  è¿™ä¸ªæŸ¥è¯¢æ˜¯ï¼šæŸ¥è¯¢å®‰å…¶æ‹‰é€‰è¯¾çš„è¯¾ç¨‹ä¿¡æ¯

  ```sql
  +------+-------------+-------+--------+---------------+---------+---------+-------------+------+--------------------------+
  | id   | select_type | table | type   | possible_keys | key     | key_len | ref         | rows | Extra                    |
  +------+-------------+-------+--------+---------------+---------+---------+-------------+------+--------------------------+
  |    1 | PRIMARY     | SC    | ref    | PRIMARY       | PRIMARY | 4       | const       | 5    | Using where; Using index |
  |    1 | PRIMARY     | C     | eq_ref | PRIMARY       | PRIMARY | 4       | mydb.SC.cid | 1    |                          |
  |    3 | SUBQUERY    | S     | ref    | name,name_age | name    | 63      | const       | 1    | Using where; Using index |
  +------+-------------+-------+--------+---------------+---------+---------+-------------+------+--------------------------+
  ```

  ç»“æœå¾ˆæ˜ç¡®ï¼šå…ˆçœ‹`id`åº”è¯¥æ˜¯Sè¡¨æœ€å…ˆè¢«è¯»å–ï¼ŒSCå’ŒCè¡¨`id`ç›¸åŒï¼Œç„¶åtableä¸­SCæ›´é ä¸Šï¼Œæ‰€ä»¥ç¬¬äºŒå¼ è¯»å–çš„è¡¨åº”å½“æ˜¯SCï¼Œæœ€åè¯»å–Cã€‚

- `select_type`å­—æ®µ

  - `SIMPLE` ç®€å•æŸ¥è¯¢ï¼Œä¸åŒ…æ‹¬å­æŸ¥è¯¢å’Œ`union`æŸ¥è¯¢

    ```sql
    EXPLAIN SELECT * FROM student JOIN stu_course ON student.`id` = sid;
    ```

    ```sql
    +------+-------------+------------+-------+---------------------+----------+---------+-----------------+------+-------------+
    | id   | select_type | table      | type  | possible_keys       | key      | key_len | ref             | rows | Extra       |
    +------+-------------+------------+-------+---------------------+----------+---------+-----------------+------+-------------+
    |    1 | SIMPLE      | student    | index | PRIMARY,id_name_age | name_age | 68      | NULL            | 30   | Using index |
    |    1 | SIMPLE      | stu_course | ref   | PRIMARY             | PRIMARY  | 4       | mydb.student.id | 1    | Using index |
    +------+-------------+------------+-------+---------------------+----------+---------+-----------------+------+-------------+
    ```

  - `PRIMARY` å½“å­˜åœ¨å­æŸ¥è¯¢æ—¶ï¼Œæœ€å¤–é¢çš„æŸ¥è¯¢è¢«æ ‡è®°ä¸ºä¸»æŸ¥è¯¢

  - `SUBQUERY` å­æŸ¥è¯¢

    ```sql
    EXPLAIN
    SELECT SC.`cid` 
    FROM stu_course AS SC 
    WHERE SC.`sid` = 
    (
        SELECT 
            S.`id` 
        FROM student AS S
        WHERE  S.`name` = "å®‰å…¶æ‹‰"
    );
    ```

    ```sql
    +------+-------------+-------+------+---------------+---------+---------+-------+------+--------------------------+
    | id   | select_type | table | type | possible_keys | key     | key_len | ref   | rows | Extra                    |
    +------+-------------+-------+------+---------------+---------+---------+-------+------+--------------------------+
    |    1 | PRIMARY     | SC    | ref  | PRIMARY       | PRIMARY | 4       | const | 5    | Using where; Using index |
    |    2 | SUBQUERY    | S     | ref  | name,name_age | name    | 63      | const | 1    | Using where; Using index |
    +------+-------------+-------+------+---------------+---------+---------+-------+------+--------------------------+
    ```

  - `DEPENDENT SUBQUERY`

    å­æŸ¥è¯¢çš„ç»“æœå—åˆ°å¤–å±‚çš„å½±å“ï¼š

    ```sql
    select id,name,(select name from student s where s.id=c.id) from course c;
    ```

    ä¸è¦åœ¨æ„SQLï¼Œä»¥ä¸ŠSQLæ²¡æœ‰å®é™…æŸ¥è¯¢çš„æ„ä¹‰åªæ˜¯ç”¨äºè¡¨è¾¾ç”¨ä¾‹

  - `UNION`

  - `UNION RESULT`

    `union`è¿æ¥çš„å¤šè¡¨æŸ¥è¯¢ï¼Œç¬¬ä¸€ä¸ªæŸ¥è¯¢æ˜¯`primary`ï¼Œåé¢çš„æ˜¯`union`, ç»“æœé›†æ˜¯`union result`

    ```sql
    EXPLAIN
    SELECT * FROM student WHERE id = 1
    UNION
    SELECT * FROM student WHERE id = 2;
    ```

    ```sql
    +------+--------------+------------+-------+---------------------+---------+---------+-------+------+-------+
    | id   | select_type  | table      | type  | possible_keys       | key     | key_len | ref   | rows | Extra |
    +------+--------------+------------+-------+---------------------+---------+---------+-------+------+-------+
    |    1 | PRIMARY      | student    | const | PRIMARY,id_name_age | PRIMARY | 4       | const | 1    |       |
    |    2 | UNION        | student    | const | PRIMARY,id_name_age | PRIMARY | 4       | const | 1    |       |
    | NULL | UNION RESULT | <union1,2> | ALL   | NULL                | NULL    | NULL    | NULL  | NULL |       |
    +------+--------------+------------+-------+---------------------+---------+---------+-------+------+-------+
    ```

    ä¸Šé¢å¯ä»¥çœ‹åˆ°ç¬¬ä¸‰è¡Œ`table`çš„å€¼æ˜¯`<union1,2>`

  - `DEPENDENT UNION`

    å’Œ`union`ä¸€æ ·ï¼Œå‡ºç°åœ¨`union`æˆ–è€…`union all`ä¸­ï¼Œä½†æ˜¯è¿™ä¸ªæŸ¥è¯¢è¦å—åˆ°å¤–éƒ¨æŸ¥è¯¢çš„å½±å“

    æ³¨æ„ï¼šä¼¼ä¹`https://www.kancloud.cn/xuwenyang/php_standard/2707424`ä¸­æè¿°çš„ç¤ºä¾‹æ˜¯é”™è¯¯çš„ï¼Œå¯¼è‡´æ²¡æœ‰ç»§ç»­ç ”ç©¶è¿™ä¸ªç±»å‹ã€‚

  - `DERIVED` åœ¨`FROM`åˆ—è¡¨ä¸­åŒ…å«çš„å­æŸ¥è¯¢è¢«æ ‡è®°ä¸º`DERIVED`ï¼ˆè¡ç”Ÿï¼‰ï¼ŒMySQLä¼šé€’å½’æ‰§è¡Œè¿™äº›å­æŸ¥è¯¢ï¼ŒæŠŠç»“æœæ”¾åœ¨ä¸´æ—¶è¡¨ä¸­

    MySQL5.7+ è¿›è¡Œä¼˜åŒ–äº†ï¼Œå¢åŠ äº†derived_mergeï¼ˆæ´¾ç”Ÿåˆå¹¶ï¼‰ï¼Œé»˜è®¤å¼€å¯ï¼Œå¯åŠ å¿«æŸ¥è¯¢æ•ˆç‡

    å½“ä½ çš„MySQLæ˜¯5.7åŠä»¥ä¸Šç‰ˆæœ¬æ—¶ä½ è¦å°†derived_mergeå…³é—­åæ‰èƒ½çœ‹åˆ°`DERIVED` çŠ¶æ€

    ```sql
    # å…³é—­session optimizer_switch
    set session optimizer_switch='derived_merge=off';
    # å…³é—­global optimizer_switch
    set global optimizer_switch='derived_merge=off';
    
    # æ˜¾ç¤ºsession optimizer_switch
    show session variables like 'optimizer_switch';
    
    # æ˜¾ç¤ºglobal optimizer_switch
    show variables like 'optimizer_switch';
    ```

    ```sql
    EXPLAIN
    SELECT * FROM 
    (
        SELECT * 
        FROM student AS S JOIN stu_course AS SC 
        ON S.`id` = SC.`sid`
    ) AS SSC;
    ```

    ```sql
    +------+-------------+------------+-------+---------------------+----------+---------+-----------+------+-------------+
    | id   | select_type | table      | type  | possible_keys       | key      | key_len | ref       | rows | Extra       |
    +------+-------------+------------+-------+---------------------+----------+---------+-----------+------+-------------+
    |    1 | PRIMARY     | <derived2> | ALL   | NULL                | NULL     | NULL    | NULL      | 30   |             |
    |    2 | DERIVED     | S          | index | PRIMARY,id_name_age | name_age | 68      | NULL      | 30   | Using index |
    |    2 | DERIVED     | SC         | ref   | PRIMARY             | PRIMARY  | 4       | mydb.S.id | 1    | Using index |
    +------+-------------+------------+-------+---------------------+----------+---------+-----------+------+-------------+
    ```

    ä¸Šé¢æˆ‘ä»¬è§‚å¯Ÿï¼Œæœ€å¤–å±‚çš„ä¸»æŸ¥è¯¢çš„è¡¨æ˜¯`<derived2>`,è€ŒSå’ŒSCè¡¨çš„`select_type`éƒ½æ˜¯`DERIVED`,è¿™è¯´æ˜Så’ŒSCéƒ½è¢«ç”¨æ¥åšè¡ç”ŸæŸ¥è¯¢ï¼Œè€Œè¿™ä¸¤å¼ è¡¨æŸ¥è¯¢çš„ç»“æœç»„æˆäº†åä¸º`<derived2>`çš„è¡ç”Ÿè¡¨ï¼Œè€Œè¡ç”Ÿè¡¨çš„å‘½åå°±æ˜¯`<select_type + id>`ã€‚

  - `partitions`å­—æ®µ

    è¯¥åˆ—æ˜¾ç¤ºçš„ä¸ºåˆ†åŒºè¡¨å‘½ä¸­çš„åˆ†åŒºæƒ…å†µã€‚éåˆ†åŒºè¡¨è¯¥å­—æ®µä¸ºç©ºï¼ˆnullï¼‰ã€‚

  - `type`å­—æ®µ

    **æ³¨æ„ï¼ï¼ï¼æ³¨æ„ï¼ï¼ï¼é‡ç‚¹æ¥äº†ï¼**

    é¦–å…ˆè¯´ä¸€ä¸‹è¿™ä¸ªå­—æ®µï¼Œè¦è®°ä½ä»¥ä¸‹10ä¸ªçŠ¶æ€ï¼Œï¼ˆä»å·¦å¾€å³ï¼Œè¶Šé å·¦è¾¹çš„è¶Šä¼˜ç§€ï¼‰

    ```
    NULL > system > const > eq_ref > ref > ref_or_null > index_merge > range > index > ALL
    ```

    - `NULL` MySQLèƒ½å¤Ÿåœ¨ä¼˜åŒ–é˜¶æ®µåˆ†è§£æŸ¥è¯¢è¯­å¥ï¼Œåœ¨æ‰§è¡Œé˜¶æ®µç”¨ä¸ç€å†è®¿é—®è¡¨æˆ–ç´¢å¼•

      æœ‰æ²¡æœ‰è¿™æ ·ä¸€ç§ç–‘æƒ‘ï¼Œä¸æŸ¥è¯¢ç´¢å¼•ä¹Ÿä¸æŸ¥è¯¢è¡¨é‚£ä½ çš„æ•°æ®æ˜¯ä»å“ªé‡Œæ¥çš„å•Šï¼Ÿè°è¯´`SELECT`è¯­å¥å¿…é¡»æŸ¥è¯¢æŸæ ·ä¸œè¥¿äº†ï¼Ÿ

      ```sql
      EXPLAIN SELECT 5*7;
      ```

      ```sql
      +------+-------------+-------+------+---------------+------+---------+------+------+----------------+
      | id   | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra          |
      +------+-------------+-------+------+---------------+------+---------+------+------+----------------+
      |    1 | SIMPLE      | NULL  | NULL | NULL          | NULL | NULL    | NULL | NULL | No tables used |
      +------+-------------+-------+------+---------------+------+---------+------+------+----------------+
      ```

      æˆ‘å°±ç®€ç®€å•å•ç®—ä¸ªæ•°ä¸å¥½å—ï¼Ÿå¥½å•ŠğŸ˜Šã€‚ã€‚ã€‚

      ä½†æ˜¯ï¼ï¼å¦‚æœåªæ˜¯è¿™æ ·çš„è¯æˆ‘ä»¬è¿˜`explain`ä¸ªæ¯›çº¿å•Šï¼æˆ‘å¾ˆé—²å—ï¼Ÿ

      å­˜åœ¨è¿™æ ·ä¸€ç§æƒ…å†µï¼Œå¤§å®¶éƒ½çŸ¥é“ç´¢å¼•æ˜¯å°†æ•°æ®åœ¨B+Treeä¸­è¿›è¡Œæ’åºäº†ï¼Œæ‰€ä»¥ä½ çš„æŸ¥è¯¢é€Ÿç‡æ‰è¿™ä¹ˆé«˜ï¼Œé‚£ä¹ˆB+æ ‘çš„æœ€è¾¹ä¸Šçš„å¶å­èŠ‚ç‚¹æ˜¯ä¸æ˜¯è¦ä¹ˆæ˜¯æœ€å¤§å€¼è¦ä¹ˆæ˜¯æœ€å°å€¼å•Šï¼Ÿæ—¢ç„¶ä½ éƒ½çŸ¥é“äº†ï¼Œé‚£MySQLæ¯”ä½ æ›´çŸ¥é“å•Šï¼å½“ä½ è¦æŸ¥è¯¢æœ€å¤§å€¼æˆ–è€…æœ€å°å€¼æ—¶ï¼ŒMySQLä¼šç›´æ¥åˆ°ä½ çš„ç´¢å¼•å¾—åˆ†å¶å­èŠ‚ç‚¹ä¸Šç›´æ¥æ‹¿ï¼Œæ‰€ä»¥ä¸ç”¨è®¿é—®è¡¨æˆ–è€…ç´¢å¼•ã€‚

      ```sql
      EXPLAIN SELECT MAX(id) FROM student;
      ```

      ```sql
      +------+-------------+-------+------+---------------+------+---------+------+------+------------------------------+
      | id   | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra                        |
      +------+-------------+-------+------+---------------+------+---------+------+------+------------------------------+
      |    1 | SIMPLE      | NULL  | NULL | NULL          | NULL | NULL    | NULL | NULL | Select tables optimized away |
      +------+-------------+-------+------+---------------+------+---------+------+------+------------------------------+
      ```

      ä½†æ˜¯ï¼ä½ è¦è®°ä½ï¼Œ`NULL`çš„å‰ææ˜¯ä½ å·²ç»å»ºç«‹äº†ç´¢å¼•ã€‚

    - `SYSTEM` è¡¨åªæœ‰ä¸€è¡Œè®°å½•ï¼ˆç­‰äºç³»ç»Ÿè¡¨ï¼‰ï¼Œè¿™æ˜¯`const`ç±»å‹çš„ç‰¹åˆ—ã€‚

      ```sql
      explain select * from (select * from course where id=1 limit 1) a;
      ```

      ```sql
      +------+-------------+------------+--------+---------------+---------+---------+-------+------+-------+
      | id   | select_type | table      | type   | possible_keys | key     | key_len | ref   | rows | Extra |
      +------+-------------+------------+--------+---------------+---------+---------+-------+------+-------+
      |    1 | PRIMARY     | <derived2> | system | NULL          | NULL    | NULL    | NULL  | 1    |       |
      |    2 | DERIVED     | course     | const  | PRIMARY       | PRIMARY | 4       | const | 1    |       |
      +------+-------------+------------+--------+---------------+---------+---------+-------+------+-------+
      ```

      

    - `const` è¡¨ç¤ºé€šè¿‡ç´¢å¼•ä¸€æ¬¡å°±æ‰¾åˆ°äº†ï¼Œ`const`ç”¨äºæ¯”è¾ƒ`primary key`æˆ–`uique`ç´¢å¼•ï¼Œå› ä¸ºåªåŒ¹é…ä¸€è¡Œæ•°æ®ï¼Œæ‰€ä»¥å¾ˆå¿«ï¼Œå¦‚ä¸»é”®ç½®äº`where`åˆ—è¡¨ä¸­ï¼ŒMySQLå°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡ã€‚

      ç®€å•æ¥è¯´ï¼Œ`const`æ˜¯ç›´æ¥æŒ‰ä¸»é”®æˆ–å”¯ä¸€é”®è¯»å–ã€‚

      ```sql
      EXPLAIN SELECT * FROM student AS S WHERE id = 10;
      ```

      ```sql
      +------+-------------+-------+-------+---------------------+---------+---------+-------+------+-------+
      | id   | select_type | table | type  | possible_keys       | key     | key_len | ref   | rows | Extra |
      +------+-------------+-------+-------+---------------------+---------+---------+-------+------+-------+
      |    1 | SIMPLE      | S     | const | PRIMARY,id_name_age | PRIMARY | 4       | const | 1    |       |
      +------+-------------+-------+-------+---------------------+---------+---------+-------+------+-------+
      ```

    - `eq_ref` ç”¨äºè”è¡¨æŸ¥è¯¢çš„æƒ…å†µï¼ŒæŒ‰è”è¡¨çš„ä¸»é”®æˆ–å”¯ä¸€é”®è”åˆæŸ¥è¯¢ã€‚

      å¤šè¡¨`join`æ—¶ï¼Œå¯¹äºæ¥è‡ªå‰é¢è¡¨çš„æ¯ä¸€è¡Œï¼Œåœ¨**å½“å‰è¡¨ä¸­åªèƒ½æ‰¾åˆ°ä¸€è¡Œ**ã€‚è¿™å¯èƒ½æ˜¯é™¤äº†`system`å’Œ`const`ä¹‹å¤–æœ€å¥½çš„ç±»å‹ã€‚å½“ä¸»é”®æˆ–å”¯ä¸€é`NULL`ç´¢å¼•çš„æ‰€æœ‰å­—æ®µéƒ½è¢«ç”¨ä½œ`join`è”æ¥æ—¶ä¼šä½¿ç”¨æ­¤ç±»å‹ã€‚

      ```sql
      EXPLAIN SELECT * FROM student AS S JOIN stu_course AS SC ON  S.`id` = SC.`cid`;
      ```

      ```sql
      +------+-------------+-------+--------+---------------------+---------+---------+-------------+------+-------------+
      | id   | select_type | table | type   | possible_keys       | key     | key_len | ref         | rows | Extra       |
      +------+-------------+-------+--------+---------------------+---------+---------+-------------+------+-------------+
      |    1 | SIMPLE      | SC    | index  | NULL                | PRIMARY | 8       | NULL        | 59   | Using index |
      |    1 | SIMPLE      | S     | eq_ref | PRIMARY,id_name_age | PRIMARY | 4       | mydb.SC.cid | 1    |             |
      +------+-------------+-------+--------+---------------------+---------+---------+-------------+------+-------------+
      ```

      ä»¥ä¸Šé¢æŸ¥è¯¢ä¸ºä¾‹ï¼Œæˆ‘ä»¬è§‚å¯Ÿ`id`å’Œ`table`ä¼šçŸ¥é“ï¼Œå…ˆæ˜¯ä»SCè¡¨ä¸­å–å‡ºä¸€è¡Œæ•°æ®ï¼Œç„¶åå†Sè¡¨æŸ¥æ‰¾åŒ¹é…çš„æ•°æ®ï¼Œæˆ‘ä»¬è§‚å¯Ÿï¼ŒSCä¸­å–å‡ºcidå’ŒSè¡¨ä¸­çš„idæ¯”è¾ƒï¼Œæ¯«æ— ç–‘é—®å› ä¸ºidæ˜¯Sè¡¨ä¸­çš„ä¸»é”®ï¼ˆä¸é‡å¤ï¼‰ï¼Œæ‰€ä»¥åªèƒ½å‡ºç°ä¸€ä¸ªidä¸cidçš„å€¼ç›¸åŒã€‚æ‰€ä»¥ï¼æ»¡è¶³æ¡ä»¶ S è¡¨çš„ `type`ä¸º`eq_ref`ã€‚

    - `ref` å¯ä»¥ç”¨äºå•è¡¨æ‰«ææˆ–è€…è¿æ¥ã€‚å¦‚æœæ˜¯è¿æ¥çš„è¯ï¼Œé©±åŠ¨è¡¨çš„ä¸€æ¡è®°å½•èƒ½å¤Ÿåœ¨è¢«é©±åŠ¨è¡¨ä¸­é€šè¿‡éå”¯ä¸€ï¼ˆä¸»é”®ï¼‰å±æ€§æ‰€åœ¨ç´¢å¼•ä¸­åŒ¹é…å¤šè¡Œæ•°æ®ï¼Œæˆ–è€…æ˜¯åœ¨å•è¡¨æŸ¥è¯¢çš„æ—¶å€™é€šè¿‡éå”¯ä¸€ï¼ˆä¸»é”®ï¼‰å±æ€§æ‰€åœ¨ç´¢å¼•ä¸­æŸ¥åˆ°ä¸€è¡Œæ•°æ®ã€‚

      ```sql
      EXPLAIN SELECT * FROM student AS S JOIN stu_course AS SC ON S.id = SC.`sid`;
      ```

      ä¸è¦åœ¨æ„SQLï¼Œä»¥ä¸ŠSQLæ²¡æœ‰å®é™…æŸ¥è¯¢çš„æ„ä¹‰åªæ˜¯ç”¨äºè¡¨è¾¾ç”¨ä¾‹

      ```sql
      +------+-------------+-------+-------+---------------------+----------+---------+-----------+------+-------------+
      | id   | select_type | table | type  | possible_keys       | key      | key_len | ref       | rows | Extra       |
      +------+-------------+-------+-------+---------------------+----------+---------+-----------+------+-------------+
      |    1 | SIMPLE      | S     | index | PRIMARY,id_name_age | name_age | 68      | NULL      | 30   | Using index |
      |    1 | SIMPLE      | SC    | ref   | PRIMARY             | PRIMARY  | 4       | mydb.S.id | 1    | Using index |
      +------+-------------+-------+-------+---------------------+----------+---------+-----------+------+-------------+
      ```

      SCçš„ä¸»é”®ç´¢å¼•æ˜¯ï¼ˆcid,sidï¼‰æ‰€ä»¥sidåˆ—ä¸­è‚¯å®šæ˜¯é‡å¤çš„æ•°æ®ï¼Œè™½ç„¶åœ¨åé¢çš„`key`ä¸­æ˜¾ç¤ºä½¿ç”¨äº†ä¸»é”®ç´¢å¼•ã€‚ç„¶åï¼Œå°±å¾ˆæ˜ç¡®äº†S.idä¸€è¡Œèƒ½åœ¨SCè¡¨ä¸­é€šè¿‡ç´¢å¼•æŸ¥è¯¢åˆ°å¤šè¡Œæ•°æ®ã€‚

      ä¸‹é¢æ˜¯å•è¡¨äº†ï¼Œå†™ä¸€ä¸ªä¾‹å­ï¼Œä½†æ˜¯ä¸ç»†è®²äº†

      ```sql
      EXPLAIN SELECT * FROM student AS S WHERE S.`name` = "å¼ é£";
      ```

      ```sql
      +------+-------------+-------+------+---------------+----------+---------+-------+------+--------------------------+
      | id   | select_type | table | type | possible_keys | key      | key_len | ref   | rows | Extra                    |
      +------+-------------+-------+------+---------------+----------+---------+-------+------+--------------------------+
      |    1 | SIMPLE      | S     | ref  | name,name_age | name_age | 63      | const | 1    | Using where; Using index |
      +------+-------------+-------+------+---------------+----------+---------+-------+------+--------------------------+
      ```

      æ³¨æ„`name`å­—æ®µæ˜¯æœ‰ç´¢å¼•çš„å“ˆï¼ï¼ï¼

    - `ref_or_null` ç±»ä¼¼refï¼Œä½†æ˜¯å¯ä»¥æœç´¢å€¼ä¸º`NULL`çš„è¡Œ

      ```sql
      EXPLAIN SELECT * FROM student AS S WHERE S.`name` = "å¼ é£" OR S.`name` IS NULL;
      ```

      ```sql
      +------+-------------+-------+-------------+---------------+----------+---------+-------+------+--------------------------+
      | id   | select_type | table | type        | possible_keys | key      | key_len | ref   | rows | Extra                    |
      +------+-------------+-------+-------------+---------------+----------+---------+-------+------+--------------------------+
      |    1 | SIMPLE      | S     | ref_or_null | name,name_age | name_age | 63      | const | 2    | Using where; Using index |
      +------+-------------+-------+-------------+---------------+----------+---------+-------+------+--------------------------+
      ```

    - `index_merge` è¡¨ç¤ºæŸ¥è¯¢ä½¿ç”¨äº†ä¸¤ä¸ªä»¥ä¸Šçš„ç´¢å¼•ï¼Œæœ€åå–äº¤é›†æˆ–è€…å¹¶é›†ï¼Œå¸¸è§`and `ï¼Œ`or`çš„æ¡ä»¶ä½¿ç”¨äº†ä¸åŒçš„ç´¢å¼•ï¼Œå®˜æ–¹æ’åºè¿™ä¸ªåœ¨`ref_or_null`ä¹‹åï¼Œä½†æ˜¯å®é™…ä¸Šç”±äºè¦è¯»å–å¤šä¸ªç´¢å¼•ï¼Œæ€§èƒ½å¯èƒ½å¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¸å¦‚`range`ã€‚

      ```sql
      EXPLAIN SELECT * FROM student AS S WHERE S.`name` LIKE "å¼ %" OR S.`age` = 30;
      ```

      ```sql
      +------+-------------+-------+-------+---------------+----------+---------+------+------+--------------------------+
      | id   | select_type | table | type  | possible_keys | key      | key_len | ref  | rows | Extra                    |
      +------+-------------+-------+-------+---------------+----------+---------+------+------+--------------------------+
      |    1 | SIMPLE      | S     | index | name,name_age | name_age | 68      | NULL | 30   | Using where; Using index |
      +------+-------------+-------+-------+---------------+----------+---------+------+------+--------------------------+
      ```

    - `range` ç´¢å¼•èŒƒå›´æŸ¥è¯¢ï¼Œå¸¸è§äºä½¿ç”¨ =, <>, >, >=, <, <=, IS NULL, <=>, BETWEEN, IN()æˆ–è€…likeç­‰è¿ç®—ç¬¦çš„æŸ¥è¯¢ä¸­ã€‚

      ```sql
      EXPLAIN SELECT S.`age` FROM student  AS S WHERE S.`age` > 30;
      ```

      ```sql
      +------+-------------+-------+-------+---------------+----------+---------+------+------+--------------------------+
      | id   | select_type | table | type  | possible_keys | key      | key_len | ref  | rows | Extra                    |
      +------+-------------+-------+-------+---------------+----------+---------+------+------+--------------------------+
      |    1 | SIMPLE      | S     | index | NULL          | name_age | 68      | NULL | 30   | Using where; Using index |
      +------+-------------+-------+-------+---------------+----------+---------+------+------+--------------------------+
      ```

    - `index` `index`åªéå†ç´¢å¼•æ ‘ï¼Œé€šå¸¸æ¯”`All`å¿«ã€‚å› ä¸ºï¼Œç´¢å¼•æ–‡ä»¶é€šå¸¸æ¯”æ•°æ®æ–‡ä»¶å°ï¼Œä¹Ÿå°±æ˜¯è™½ç„¶`all`å’Œ`index`éƒ½æ˜¯è¯»å…¨è¡¨ï¼Œä½†`index`æ˜¯ä»ç´¢å¼•ä¸­è¯»å–çš„ï¼Œè€Œ`all`æ˜¯ä»ç¡¬ç›˜è¯»çš„ã€‚

      ```sql
      EXPLAIN SELECT S.`name` FROM student AS S;
      ```

      ```sql
      +------+-------------+-------+-------+---------------+------+---------+------+------+-------------+
      | id   | select_type | table | type  | possible_keys | key  | key_len | ref  | rows | Extra       |
      +------+-------------+-------+-------+---------------+------+---------+------+------+-------------+
      |    1 | SIMPLE      | S     | index | NULL          | name | 63      | NULL | 30   | Using index |
      +------+-------------+-------+-------+---------------+------+---------+------+------+-------------+
      ```

    - `ALL` å¦‚æœä¸€ä¸ªæŸ¥è¯¢çš„`type`æ˜¯`All`,å¹¶ä¸”è¡¨çš„æ•°æ®é‡å¾ˆå¤§ï¼Œé‚£ä¹ˆè¯·è§£å†³å®ƒï¼ï¼ï¼

  - `possible_keys`å­—æ®µ

    è¿™ä¸ªè¡¨é‡Œé¢å­˜åœ¨ä¸”å¯èƒ½ä¼šè¢«ä½¿ç”¨çš„ç´¢å¼•ï¼Œå¯èƒ½ä¼šåœ¨è¿™ä¸ªå­—æ®µä¸‹é¢å‡ºç°ï¼Œä½†æ˜¯ä¸€èˆ¬éƒ½ä»¥`key`ä¸ºå‡†ã€‚

  - `key`å­—æ®µ

    å®é™…ä½¿ç”¨çš„ç´¢å¼•ï¼Œå¦‚æœä¸º`null`,åˆ™æ²¡æœ‰ä½¿ç”¨ç´¢å¼•ï¼Œå¦åˆ™ä¼šæ˜¾ç¤ºä½ ä½¿ç”¨äº†å“ªäº›ç´¢å¼•ï¼ŒæŸ¥è¯¢ä¸­è‹¥ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•ï¼ˆæŸ¥è¯¢çš„åˆ—åˆšå¥½æ˜¯ç´¢å¼•ï¼‰ï¼Œåˆ™è¯¥ç´¢å¼•ä»…å‡ºç°åœ¨`key`åˆ—è¡¨ã€‚

  - `ref`å­—æ®µ

    æ˜¾ç¤ºå“ªäº›åˆ—è¢«ä½¿ç”¨äº†ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œæœ€å¥½æ˜¯ä¸€ä¸ªå¸¸æ•°ã€‚å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼ã€‚

  - `rows`å­—æ®µ

    æ‰§è¡Œè®¡åˆ’ä¼°ç®—çš„æ‰«æè¡Œæ•°ï¼Œä¸æ˜¯ç²¾ç¡®å€¼ï¼ˆinnodbä¸æ˜¯ç²¾ç¡®å€¼ï¼Œmyisamæ˜¯ç²¾ç¡®å€¼ï¼Œä¸»è¦æ˜¯å› ä¸ºinnodbä½¿ç”¨äº†mvccï¼‰ã€‚

  - `filtered`å­—æ®µ

    `filtered`åˆ—æ˜¾ç¤ºçš„æ˜¯ï¼Œå¯¹äºè¡¨ä¸­çš„æ¯ä¸€è¡Œï¼Œæ»¡è¶³WHEREå­å¥ï¼ˆä»¥åŠå…¶ä»–å¯èƒ½å½±å“è¡Œé€‰æ‹©çš„æ¡ä»¶ï¼Œå¦‚JOINæ¡ä»¶ï¼‰çš„ç™¾åˆ†æ¯”ã€‚è¿™ä¸ªç™¾åˆ†æ¯”æ˜¯åŸºäºMySQLçš„ç»Ÿè®¡ä¿¡æ¯å’Œä¼˜åŒ–å™¨çš„ä¼°ç®—ï¼Œè€Œä¸æ˜¯å®é™…æ‰§è¡Œçš„è¡Œæ•°ã€‚å› æ­¤ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªè¿‘ä¼¼å€¼ï¼Œä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒå¯¹äºç†è§£æŸ¥è¯¢çš„æ•ˆç‡å’Œå¯èƒ½çš„æ€§èƒ½ç“¶é¢ˆæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚æ˜¯æŸ¥è¯¢çš„è¡Œæ•°ä¸æ€»è¡Œæ•°çš„æ¯”å€¼ã€‚å…¶å®ä½œç”¨ä¸`rows`å·®ä¸å¤šï¼Œéƒ½æ˜¯æ•°å€¼è¶Šå°ï¼Œæ•ˆç‡è¶Šé«˜ã€‚

    **é«˜ç™¾åˆ†æ¯”**ï¼šå¦‚æœ`filtered`åˆ—çš„å€¼å¾ˆé«˜ï¼ˆæ¯”å¦‚æ¥è¿‘100%ï¼‰ï¼Œè¿™é€šå¸¸æ„å‘³ç€WHEREå­å¥éå¸¸å®½æ¾ï¼Œæˆ–è€…è¯¥è¡¨çš„å¤§éƒ¨åˆ†è¡Œéƒ½ç¬¦åˆWHEREå­å¥çš„æ¡ä»¶ã€‚è¿™å¹¶ä¸ä¸€å®šæ„å‘³ç€æŸ¥è¯¢å°±æ˜¯é«˜æ•ˆçš„ï¼Œä½†å¦‚æœç´¢å¼•ä½¿ç”¨å¾—å½“ï¼Œå®ƒå¯èƒ½è¡¨æ˜MySQLå¯ä»¥éå¸¸æœ‰æ•ˆåœ°æ‰¾åˆ°è¿™äº›è¡Œã€‚

    **ä½ç™¾åˆ†æ¯”**ï¼šç›¸åï¼Œå¦‚æœ`filtered`åˆ—çš„å€¼å¾ˆä½ï¼ˆæ¯”å¦‚åªæœ‰å‡ %ï¼‰ï¼Œè¿™è¡¨ç¤ºWHEREå­å¥éå¸¸ä¸¥æ ¼ï¼Œåªæœ‰è¡¨ä¸­çš„ä¸€å°éƒ¨åˆ†è¡Œæ»¡è¶³æ¡ä»¶ã€‚è¿™é€šå¸¸æ˜¯å¥½äº‹ï¼Œå› ä¸ºå®ƒå‡å°‘äº†MySQLéœ€è¦å¤„ç†çš„æ•°æ®é‡ï¼Œä½†å‰ææ˜¯MySQLèƒ½å¤Ÿæœ‰æ•ˆåœ°åˆ©ç”¨ç´¢å¼•æ¥æ‰¾åˆ°è¿™äº›è¡Œã€‚

    å‡è®¾ä½ æœ‰ä¸€ä¸ªåä¸º`employees`çš„è¡¨ï¼Œä½ æ‰§è¡Œäº†ä»¥ä¸‹æŸ¥è¯¢ï¼Œå¹¶ä½¿ç”¨äº†`EXPLAIN`æ¥åˆ†æå®ƒï¼š

    ```sql
    EXPLAIN SELECT * FROM employees WHERE department_id = 5;
    ```

    å¦‚æœ`filtered`åˆ—æ˜¾ç¤ºçš„æ˜¯`10.00`ï¼Œè¿™æ„å‘³ç€MySQLä¼°è®¡å¤§çº¦åªæœ‰10%çš„`employees`è¡¨ä¸­çš„è¡Œæ»¡è¶³`department_id = 5`çš„æ¡ä»¶ã€‚å¦‚æœ`employees`è¡¨æœ‰ä¸€ä¸ªé’ˆå¯¹`department_id`çš„ç´¢å¼•ï¼Œå¹¶ä¸”MySQLèƒ½å¤Ÿä½¿ç”¨è¿™ä¸ªç´¢å¼•æ¥è¿‡æ»¤è¡Œï¼Œé‚£ä¹ˆå³ä½¿åªæœ‰10%çš„è¡Œæ»¡è¶³æ¡ä»¶ï¼ŒæŸ¥è¯¢ä¹Ÿåº”è¯¥èƒ½å¤Ÿé«˜æ•ˆåœ°æ‰§è¡Œã€‚

  - `Extra`å­—æ®µ

    è¿™ä¸€å­—æ®µåŒ…å«ä¸é€‚åˆåœ¨å…¶ä»–åˆ—æ˜¾ç¤ºï¼Œä½†æ˜¯ä¹Ÿéå¸¸é‡è¦çš„é¢å¤–ä¿¡æ¯ã€‚

    - `Using filesort` è¡¨ç¤ºå½“SQLä¸­æœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦å¯¹ä¸€äº›æ•°æ®è¿›è¡Œæ’åºçš„æ—¶å€™ï¼Œä¼˜åŒ–å™¨æ‰¾ä¸åˆ°èƒ½å¤Ÿä½¿ç”¨çš„ç´¢å¼•ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨å¤–éƒ¨çš„ç´¢å¼•æ’åºï¼Œå¤–éƒ¨æ’åºå°±ä¸æ–­çš„åœ¨ç£ç›˜å’Œå†…å­˜ä¸­äº¤æ¢æ•°æ®ï¼Œè¿™æ ·å°±æ‘†è„±ä¸äº†å¾ˆå¤šæ¬¡ç£ç›˜IOï¼Œä»¥è‡³äºSQLæ‰§è¡Œçš„æ•ˆç‡å¾ˆä½ã€‚åä¹‹å‘¢ï¼Ÿç”±äºç´¢å¼•çš„åº•å±‚æ˜¯B+Treeå®ç°çš„ï¼Œä»–çš„å¶å­èŠ‚ç‚¹æœ¬æ¥å°±æ˜¯æœ‰åºçš„ï¼Œè¿™æ ·çš„æŸ¥è¯¢èƒ½ä¸çˆ½å—ï¼Ÿ

      ```sql
      EXPLAIN SELECT * FROM course AS C ORDER BY C.`name`;
      ```

      ```sql
      +------+-------------+-------+------+---------------+------+---------+------+------+----------------+
      | id   | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra          |
      +------+-------------+-------+------+---------------+------+---------+------+------+----------------+
      |    1 | SIMPLE      | C     | ALL  | NULL          | NULL | NULL    | NULL | 20   | Using filesort |
      +------+-------------+-------+------+---------------+------+---------+------+------+----------------+
      ```

      æ²¡æœ‰ç»™`C.name`å»ºç«‹ç´¢å¼•ï¼Œæ‰€ä»¥åœ¨æ ¹æ®`C.name`æ’åºçš„æ—¶å€™ï¼Œä»–å°±ä½¿ç”¨äº†å¤–éƒ¨æ’åº

    - `Using tempporary` è¡¨ç¤ºåœ¨å¯¹MySQLæŸ¥è¯¢ç»“æœè¿›è¡Œæ’åºæ—¶ï¼Œä½¿ç”¨äº†ä¸´æ—¶è¡¨,,è¿™æ ·çš„æŸ¥è¯¢æ•ˆç‡æ˜¯æ¯”å¤–éƒ¨æ’åºæ›´ä½çš„ï¼Œå¸¸è§äº`order by`å’Œ`group by`ã€‚

      ```sql
      EXPLAIN SELECT C.`name` FROM course AS C GROUP BY C.`name`;
      ```

      ```sql
      +------+-------------+-------+------+---------------+------+---------+------+------+---------------------------------+
      | id   | select_type | table | type | possible_keys | key  | key_len | ref  | rows | Extra                           |
      +------+-------------+-------+------+---------------+------+---------+------+------+---------------------------------+
      |    1 | SIMPLE      | C     | ALL  | NULL          | NULL | NULL    | NULL | 20   | Using temporary; Using filesort |
      +------+-------------+-------+------+---------------+------+---------+------+------+---------------------------------+
      ```

      ä¸Šé¢è¿™ä¸ªæŸ¥è¯¢å°±æ˜¯åŒæ—¶è§¦å‘äº†`Using temporary`å’Œ`Using filesort`ï¼Œå¯è°“æ˜¯é›ªä¸ŠåŠ éœœã€‚

      ä¸´æ—¶è¡¨å¯ä»¥æ˜¯å†…å­˜ä¸´æ—¶è¡¨å’Œç£ç›˜ä¸´æ—¶è¡¨ï¼Œæ‰§è¡Œè®¡åˆ’ä¸­çœ‹ä¸å‡ºæ¥ï¼Œéœ€è¦æŸ¥çœ‹statuså˜é‡ï¼šused_tmp_tableã€used_tmp_disk_tableæ‰å¯ä»¥çœ‹å‡ºæ¥

    - `Using index` 

      è¡¨ç¤ºä½¿ç”¨äº†ç´¢å¼•ï¼Œå¾ˆä¼˜ç§€ğŸ‘ã€‚

      æŸ¥è¯¢æ—¶å€™ä¸éœ€è¦å›è¡¨ï¼Œè¡¨ç¤ºç›¸åº”çš„selectæŸ¥è¯¢ä¸­ä½¿ç”¨åˆ°äº†**è¦†ç›–ç´¢å¼•(Covering index)**ï¼Œé¿å…è®¿é—®è¡¨çš„æ•°æ®è¡Œ

      å¦‚æœåŒæ—¶å‡ºç°äº†using whereï¼Œè¯´æ˜ç´¢å¼•è¢«ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢é”®å€¼

      å¦‚æœæ²¡æœ‰using whereï¼Œè¡¨ç¤ºè¯»å–æ•°æ®è€Œä¸æ˜¯æ‰§è¡ŒæŸ¥æ‰¾æ“ä½œ

    - `Using where`

      è¡¨ç¤ºå­˜å‚¨å¼•æ“è¿”å›çš„è®°å½•å¹¶ä¸éƒ½æ˜¯ç¬¦åˆæ¡ä»¶çš„ï¼Œéœ€è¦åœ¨serverå±‚è¿›è¡Œç­›é€‰è¿‡æ»¤ï¼Œæ€§èƒ½å¾ˆä½

      ```sql
      explain select * from course where name='é«˜ç­‰æ•°å­¦';
      ```

      ```sql
      +------+-------------+--------+------+---------------+------+---------+------+------+-------------+
      | id   | select_type | table  | type | possible_keys | key  | key_len | ref  | rows | Extra       |
      +------+-------------+--------+------+---------------+------+---------+------+------+-------------+
      |    1 | SIMPLE      | course | ALL  | NULL          | NULL | NULL    | NULL | 20   | Using where |
      +------+-------------+--------+------+---------------+------+---------+------+------+-------------+
      ```

      

    - `Using join buffer` è¡¨æ˜ä½¿ç”¨äº†è¿æ¥ç¼“å­˜,æ¯”å¦‚è¯´åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¤šè¡¨`join`çš„æ¬¡æ•°éå¸¸å¤šï¼Œé‚£ä¹ˆå°†é…ç½®æ–‡ä»¶ä¸­çš„ç¼“å†²åŒºçš„`join buffer`è°ƒå¤§ä¸€äº›ã€‚

    - `impossible where` ç­›é€‰æ¡ä»¶æ²¡èƒ½ç­›é€‰å‡ºä»»ä½•ä¸œè¥¿

    - `distinct` ä¼˜åŒ–`distinct`æ“ä½œï¼Œåœ¨æ‰¾åˆ°ç¬¬ä¸€åŒ¹é…çš„å…ƒç»„åå³åœæ­¢æ‰¾åŒæ ·å€¼çš„åŠ¨ä½œ



### `explain extended`å‘½ä»¤

>[explain extended](https://mariadb.com/kb/en/explain/#explain-extended)

`explain extended`åœ¨`mysql`ä¸å­˜åœ¨ï¼Œä½†èƒ½å¤Ÿåœ¨`mariadb`ä¸­ä½¿ç”¨ã€‚

`explain extended`å‘è¾“å‡ºæ·»åŠ äº†å¦ä¸€åˆ—ï¼Œå³`filtered`åˆ—ã€‚è¿™æ˜¯å°†æŒ‰æ¡ä»¶è¿‡æ»¤çš„è¡¨è¡Œçš„ç™¾åˆ†æ¯”ä¼°è®¡å€¼ã€‚



## `explain analyze`å‘½ä»¤

åœ¨MySQLä¸­ï¼Œ`EXPLAIN ANALYZE`æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºå¯¹SQLæŸ¥è¯¢æ‰§è¡Œè¯¦ç»†çš„åˆ†æã€‚ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶`EXPLAIN`è¯­å¥åœ¨MySQLä¸­å¹¿æ³›ä½¿ç”¨ä»¥æŸ¥çœ‹æŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’ï¼Œä½†ç›´åˆ°MySQL 8.0.18ç‰ˆæœ¬ä¹‹å‰ï¼ŒMySQLå¹¶æ²¡æœ‰ç›´æ¥æä¾›åä¸º`EXPLAIN ANALYZE`çš„è¯­å¥ã€‚

ä»MySQL 8.0.18å¼€å§‹ï¼ŒMySQLå¼•å…¥äº†ä¸€ç§æ–°çš„æ–¹å¼æ¥åˆ†ææŸ¥è¯¢çš„æ‰§è¡Œæƒ…å†µï¼Œè¿™é€šå¸¸æ˜¯é€šè¿‡`EXPLAIN ANALYZE`å‘½ä»¤ï¼ˆæˆ–è€…æ›´å…·ä½“åœ°è¯´ï¼Œæ˜¯åœ¨`EXPLAIN`è¯­å¥ä¸­ä½¿ç”¨`ANALYZE`é€‰é¡¹ï¼‰æ¥å®ç°çš„ã€‚ç„¶è€Œï¼ŒMySQLå®˜æ–¹æ–‡æ¡£å¯èƒ½å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨`EXPLAIN ANALYZE`è¿™æ ·çš„å‘½ä»¤åç§°ï¼Œè€Œæ˜¯å°†å…¶ä½œä¸º`EXPLAIN`è¯­å¥çš„ä¸€ä¸ªæ‰©å±•æˆ–é€‰é¡¹æ¥ä»‹ç»ã€‚

åœ¨MySQL 8.0.18åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡`EXPLAIN ANALYZE`ï¼ˆå°½ç®¡å¯èƒ½éœ€è¦ä»¥`EXPLAIN ... ANALYZE`çš„å½¢å¼ï¼‰æ¥æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¹¶è·å–æ¯”ä¼ ç»Ÿ`EXPLAIN`æ›´è¯¦ç»†çš„æ‰§è¡Œä¿¡æ¯ï¼ŒåŒ…æ‹¬å®é™…çš„è¿è¡Œæ—¶é—´ã€è¿­ä»£æ¬¡æ•°ã€è¡Œæ•°ç­‰ã€‚è¿™æœ‰åŠ©äºä½ æ›´æ·±å…¥åœ°äº†è§£æŸ¥è¯¢çš„æ€§èƒ½ç‰¹æ€§ï¼Œå¹¶æ®æ­¤è¿›è¡Œä¼˜åŒ–ã€‚

ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œç”±äºMySQLç‰ˆæœ¬çš„æ›´æ–°å’Œæ–‡æ¡£çš„å˜åŒ–ï¼Œæœ€å‡†ç¡®çš„ä¿¡æ¯åº”è¯¥æ¥è‡ªä½ æ­£åœ¨ä½¿ç”¨çš„MySQLç‰ˆæœ¬çš„å®˜æ–¹æ–‡æ¡£ã€‚

ä¾‹å¦‚ï¼Œåœ¨MySQL 8.0.xç‰ˆæœ¬ä¸­ï¼Œä½ å¯èƒ½ä¼šè¿™æ ·ä½¿ç”¨å®ƒï¼š

```sql
EXPLAIN ANALYZE SELECT * FROM your_table WHERE some_column = 'some_value';
```



## `show table status`



### å¤§çº¦è·å–è¡¨è®°å½•æ€»æ•°

>å½“è¡¨æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œä½¿ç”¨ `select count(id)` æ–¹å¼è·å–è®°å½•æ€»æ•°ä¼šå¾ˆæ…¢ã€‚

è·å– t_order è®°å½•æ€»æ•°

```sql
show table status like 't_order';
```

