# 布隆过滤器

## 什么是布隆过滤器

布隆过滤器（Bloom Filter）是一种空间效率很高的概率型数据结构，由Burton Howard Bloom在1970年提出。它主要用于在大量数据中判断一个元素是否可能存在，具有高效插入和查询的特点。布隆过滤器的主要作用包括：

1. **存在性判断**：高效地判断一个元素是否在一个集合中。虽然返回的结果是概率性的，但可以通过调整参数来降低误判率。
2. **去重**：在数据去重场景中，布隆过滤器可以快速判断一个元素是否已经被处理过，从而避免重复处理。
3. **缓存穿透防护**：在缓存系统中，布隆过滤器可以用来判断请求的数据是否有效，避免直接绕过缓存请求数据库，从而减轻数据库压力。
4. **黑名单过滤**：在网络服务中，可以使用布隆过滤器来过滤掉黑名单中的IP地址或手机号码等，提高系统的安全性。
5. **垃圾邮件过滤**：在邮件系统中，布隆过滤器可以用来判断一个邮件地址是否在垃圾邮件列表中，从而减少垃圾邮件的发送。

### 布隆过滤器的例子

以下是一个布隆过滤器在缓存穿透防护中的使用例子：

假设我们有一个缓存系统，用于存储用户信息。当用户发起请求时，系统会首先查询缓存中是否存在该用户的信息。如果不存在，系统会再去数据库中查询。然而，如果有很多请求都是针对不存在的用户，那么这些请求都会直接穿透缓存到达数据库，给数据库带来巨大压力。

为了解决这个问题，我们可以在缓存系统前添加一个布隆过滤器。当用户发起请求时，系统会先通过布隆过滤器判断该用户是否可能存在。如果布隆过滤器判断该用户不存在（即所有对应的位数组位置都为0），则直接返回用户不存在的结果，无需再去查询缓存和数据库。如果布隆过滤器判断该用户可能存在（即所有对应的位数组位置都为1），则继续后续的缓存和数据库查询流程。

需要注意的是，由于布隆过滤器的结果是概率性的，所以存在误判的可能。即布隆过滤器判断某个用户可能存在，但实际上该用户并不存在。但是，这种误判的概率是可以通过调整布隆过滤器的参数来降低的。同时，由于布隆过滤器只能添加元素，不能删除元素，所以在实际应用中需要根据具体场景来选择是否使用布隆过滤器以及如何使用。

### 总结

布隆过滤器作为一种高效的空间节省型概率数据结构，在大量数据的存在性判断、去重、缓存穿透防护等场景中有着广泛的应用。虽然其返回的结果是概率性的，但可以通过调整参数来降低误判率。同时，由于布隆过滤器无法删除元素，所以在实际应用中需要根据具体需求来选择是否使用以及如何使用。



## `guava`中布隆过滤器用法

> `guava`中布隆过滤器详细用法请参考[demo-bloomfilter](https://github.com/dexterleslie1/demonstration/tree/master/demo-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/demo-bloomfilter)

在`BloomFilter<T>`的`create`方法中，参数的含义对于理解如何配置和使用布隆过滤器至关重要。这个方法通常用于创建或初始化一个布隆过滤器实例，以便后续用于检查元素是否可能存在于一个集合中。以下是各个参数的具体含义：

1. `Funnel<? super T> funnel`:
   - `Funnel`是一个接口，用于定义如何将任意类型的对象`T`“倒入”到一个基本的数据类型数组中（通常是字节数组），以便进行哈希。这个接口使得布隆过滤器能够处理各种类型的对象，而不仅仅是基本数据类型或字符串。
   - `? super T`是Java的泛型通配符，表示这个`Funnel`可以接受`T`类型或`T`的任何父类型（包括`T`本身）。这增加了灵活性，允许使用能够处理更广泛类型的`Funnel`。
2. `int expectedInsertions`:
   - 这个参数指定了预计要插入到布隆过滤器中的元素数量。这个值对于布隆过滤器的性能至关重要，因为它直接影响到布隆过滤器的大小（即使用的位数组的大小）和哈希函数的数量。
   - 预期的插入数越多，布隆过滤器需要越多的位和哈希函数来保持误报率（False Positive Probability, FPP）在可接受的范围内。
3. `double fpp`:
   - `fpp`代表误报率（False Positive Probability），即布隆过滤器错误地认为一个不在集合中的元素存在的概率。
   - 布隆过滤器允许存在误报，但不允许漏报（即如果一个元素实际上在集合中，布隆过滤器不会报告它不在）。
   - 误报率是一个在0到1之间的浮点数，值越小，布隆过滤器需要的空间就越大，以维持较低的误报率。

总的来说，`create`方法的这三个参数共同决定了布隆过滤器的性能和行为：`funnel`决定了如何将对象映射到哈希值，`expectedInsertions`决定了布隆过滤器需要多大的空间来存储信息，而`fpp`则设定了布隆过滤器可以容忍的误报率上限。

