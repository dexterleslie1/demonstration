<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自定义HTML元素演示</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        popup-info {
            display: block;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>自定义HTML元素演示</h1>
    
    <div class="container">
        <h2>1. 独立自定义元素 (popup-info)</h2>
        <p>这是一个独立的自定义元素，继承自 HTMLElement：</p>
        <popup-info img="https://via.placeholder.com/20" text="这是一条重要信息！"></popup-info>
        <popup-info img="https://via.placeholder.com/20" text="自定义元素可以轻松扩展HTML功能。"></popup-info>
    </div>
    
    <div class="container">
        <h2>2. 自定义内置元素 (word-count)</h2>
        <p>这是一个自定义内置元素，继承自 HTMLParagraphElement：</p>
        <p is="word-count">这是一个包含多个单词的段落，用于演示自定义内置元素的功能。</p>
        <p is="word-count">自定义内置元素允许我们扩展现有的HTML元素。</p>
    </div>

    <script>
        // 1. 独立自定义元素: popup-info
        class PopupInfo extends HTMLElement {
            constructor() {
                super();
                
                // 创建影子根
                const shadow = this.attachShadow({ mode: 'open' });
                
                // 创建结构
                const wrapper = document.createElement('span');
                wrapper.setAttribute('class', 'wrapper');
                
                const icon = document.createElement('span');
                icon.setAttribute('class', 'icon');
                icon.setAttribute('tabindex', 0);
                
                const img = document.createElement('img');
                img.src = this.getAttribute('img');
                img.alt = '信息图标';
                
                const info = document.createElement('span');
                info.setAttribute('class', 'info');
                
                // 获取并设置text属性
                const text = this.getAttribute('text');
                info.textContent = text;
                
                // 创建样式
                const style = document.createElement('style');
                style.textContent = `
                    .wrapper {
                        position: relative;
                        display: inline-block;
                    }
                    .icon {
                        cursor: pointer;
                    }
                    .icon img {
                        width: 20px;
                        height: 20px;
                    }
                    .info {
                        position: absolute;
                        bottom: 125%;
                        left: 50%;
                        transform: translateX(-50%);
                        background-color: #333;
                        color: white;
                        padding: 8px 12px;
                        border-radius: 4px;
                        font-size: 14px;
                        white-space: nowrap;
                        opacity: 0;
                        visibility: hidden;
                        transition: opacity 0.3s, visibility 0.3s;
                    }
                    .info::after {
                        content: '';
                        position: absolute;
                        top: 100%;
                        left: 50%;
                        transform: translateX(-50%);
                        border-width: 5px;
                        border-style: solid;
                        border-color: #333 transparent transparent transparent;
                    }
                    .icon:hover + .info,
                    .icon:focus + .info {
                        opacity: 1;
                        visibility: visible;
                    }
                `;
                
                // 组装
                icon.appendChild(img);
                wrapper.appendChild(icon);
                wrapper.appendChild(info);
                shadow.appendChild(style);
                shadow.appendChild(wrapper);
            }
        }
        
        // 注册独立自定义元素
        customElements.define('popup-info', PopupInfo);
        
        // 2. 自定义内置元素: word-count
        class WordCount extends HTMLParagraphElement {
            constructor() {
                super();
            }
            
            connectedCallback() {
                this.updateWordCount();
            }
            
            updateWordCount() {
                const text = this.textContent;
                // 计算单词数量的核心逻辑
                // 1. text.trim() - 移除文本开头和结尾的空白字符
                // 2. split(/\s+/) - 使用正则表达式按一个或多个空白字符（空格、制表符、换行符等）分割文本
                // 3. filter(word => word.length > 0) - 过滤掉分割后产生的空字符串
                // 最终得到一个包含所有实际单词的数组
                const words = text.trim().split(/\s+/).filter(word => word.length > 0);
                const count = words.length;
                
                // 使用dataset API设置元素的data-*属性
                // 1. dataset是HTML5提供的API，用于访问和操作元素的data-*属性
                // 2. wordCount是驼峰命名，会自动转换为连字符命名的data-word-count
                // 3. 这样可以将计算出的单词数量存储到元素的自定义数据属性中
                // 4. 便于在CSS或JavaScript中通过[data-word-count]选择器或element.dataset.wordCount访问
                this.dataset.wordCount = count;
                
                // 如果还没有计数元素，则创建
                if (!this.querySelector('.word-count')) {
                    const countSpan = document.createElement('span');
                    countSpan.className = 'word-count';
                    countSpan.style.color = '#666';
                    countSpan.style.fontSize = '0.8em';
                    countSpan.style.marginLeft = '10px';
                    countSpan.textContent = `(${count} 词)`;
                    this.appendChild(countSpan);
                } else {
                    // 更新现有计数
                    this.querySelector('.word-count').textContent = `(${count} 词)`;
                }
            }
        }
        
        // 注册自定义内置元素
        // customElements.define() 方法用于向浏览器注册自定义元素
        // 第一个参数 'word-count'：自定义元素的名称，必须包含连字符
        // 第二个参数 WordCount：自定义元素的类定义，继承自 HTMLParagraphElement
        // 第三个参数 { extends: 'p' }：配置对象，指定该自定义元素扩展自原生的 p 元素
        // 这种注册方式创建的是自定义内置元素，可以通过 <p is="word-count"> 的方式使用
        customElements.define('word-count', WordCount, { extends: 'p' });
    </script>
</body>
</html>